{"ast":null,"code":"import React,{useState,useEffect,useRef,useMemo}from'react';import{db}from'../config/firebase';import{collection,getDocs,onSnapshot}from'firebase/firestore';import{MapContainer,TileLayer,Marker,Popup,LayerGroup,useMap}from'react-leaflet';import L from'leaflet';import'leaflet/dist/leaflet.css';import'./MapView.css';import'leaflet.markercluster';import'./MarkerCluster.css';import'./MarkerCluster.Default.css';// Renommer les imports pour éviter les conflits avec les interfaces locales\n// import { Site, Tournee, MarkerPreference } from '../types';\n// Fix pour les icônes Leaflet\nimport markerIcon2x from'leaflet/dist/images/marker-icon-2x.png';import markerIcon from'leaflet/dist/images/marker-icon.png';import markerShadow from'leaflet/dist/images/marker-shadow.png';// Correction pour les icônes Leaflet\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";delete L.Icon.Default.prototype._getIconUrl;L.Icon.Default.mergeOptions({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});// Définir des icônes spécifiques\nconst siteIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});const departIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});const arrivalIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});// Définir des icônes spécifiques pour chaque type de site\nconst laboratoireIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-laboratoire'});const cliniqueIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-clinique'});const plateauIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-plateau'});const collecteIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-collecte'});const etablissementIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-etablissement'});const ehpadIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-ehpad'});const veterinaireIcon=L.icon({iconUrl:markerIcon,iconRetinaUrl:markerIcon2x,shadowUrl:markerShadow,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41],className:'site-icon site-icon-veterinaire'});// Types de sites disponibles\nconst SITE_TYPES=['Laboratoire','Clinique','Plateau technique','Point de collecte','Etablissement de sant�','Ehpad','V�t�rinaire'];// P�les disponibles\nconst POLES=['Nord','Sud','Est','Ouest','Centre'];// Fonction pour normaliser les types de sites\nconst normalizeType=type=>{if(!type)return'';const normalized=type.toLowerCase().trim();// Normaliser les types courants avec des correspondances plus pr�cises\nconst typeMap={'labo':'laboratoire','laboratoire':'laboratoire','plateau':'plateau technique','plateau technique':'plateau technique','clinique':'clinique','collect':'point de collecte','point de collecte':'point de collecte','etablissement':'etablissement de sant�','�tablissement':'etablissement de sant�','etablissement de sant�':'etablissement de sant�','�tablissement de sant�':'etablissement de sant�','ehpad':'ehpad','veterinaire':'veterinaire','v�t�rinaire':'veterinaire'};// Recherche de correspondance exacte ou partielle\nfor(const[key,value]of Object.entries(typeMap)){if(normalized===key||normalized.includes(key)){return value;}}return normalized;};// Fonction pour obtenir l'ic�ne par d�faut en fonction du type de site\nconst getDefaultIconForSiteType=type=>{if(!type)return siteIcon;// Normaliser le type pour la comparaison\nconst normalizedType=normalizeType(type);// Retourner l'ic�ne correspondante\nif(normalizedType==='laboratoire'){return laboratoireIcon;}else if(normalizedType==='clinique'){return cliniqueIcon;}else if(normalizedType==='plateau technique'){return plateauIcon;}else if(normalizedType==='point de collecte'){return collecteIcon;}else if(normalizedType==='etablissement de sant�'){return etablissementIcon;}else if(normalizedType==='ehpad'){return ehpadIcon;}else if(normalizedType==='veterinaire'){return veterinaireIcon;}// Par d�faut, retourner l'ic�ne g�n�rique\nreturn siteIcon;};// Composant pour ajouter le contr�le plein �cran personnalis�\nconst FullscreenControl=()=>{const map=useMap();const[isFullscreen,setIsFullscreen]=useState(false);useEffect(()=>{// Cr�er un contr�le personnalis�\nconst FullscreenControl=L.Control.extend({options:{position:'topleft'},onAdd:function(){const container=L.DomUtil.create('div','leaflet-bar leaflet-control');const button=L.DomUtil.create('a','leaflet-control-fullscreen',container);button.innerHTML='<i class=\"fas fa-expand\"></i>';// Utiliser une ic�ne FontAwesome\nbutton.href='#';button.title='Afficher en plein �cran';button.setAttribute('role','button');button.setAttribute('aria-label','Afficher en plein �cran');L.DomEvent.on(button,'click',function(e){L.DomEvent.preventDefault(e);const mapContainer=map.getContainer();if(!document.fullscreenElement){if(mapContainer.requestFullscreen){mapContainer.requestFullscreen();button.innerHTML='<i class=\"fas fa-compress\"></i>';// Ic�ne de r�duction\nbutton.title='Quitter le plein �cran';setIsFullscreen(true);}}else{if(document.exitFullscreen){document.exitFullscreen();button.innerHTML='<i class=\"fas fa-expand\"></i>';// Ic�ne d'agrandissement\nbutton.title='Afficher en plein �cran';setIsFullscreen(false);}}});// �couter les changements d'�tat du plein �cran\nconst handleFullscreenChange=()=>{if(!document.fullscreenElement&&isFullscreen){button.innerHTML='<i class=\"fas fa-expand\"></i>';button.title='Afficher en plein �cran';setIsFullscreen(false);}};document.addEventListener('fullscreenchange',handleFullscreenChange);return container;}});// Ajouter le contr�le � la carte\nconst fullscreenControl=new FullscreenControl();map.addControl(fullscreenControl);return()=>{map.removeControl(fullscreenControl);document.removeEventListener('fullscreenchange',()=>{});};},[map,isFullscreen]);return null;};// Composant pour afficher tous les sites\nconst AllSitesLayer=_ref=>{let{sites,icon,getIconForSiteType,showLabels,showGeneratedCoordinates}=_ref;const map=useMap();const layerRef=useRef(null);const[isVisible,setIsVisible]=useState(true);useEffect(()=>{// Cr�er un nouveau LayerGroup si n�cessaire\nif(!layerRef.current){layerRef.current=L.layerGroup();// Ajouter le LayerGroup �  la carte si la couche est visible\nif(isVisible){layerRef.current.addTo(map);}}else{// Sinon, vider le LayerGroup existant\nlayerRef.current.clearLayers();// Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\nif(isVisible&&!map.hasLayer(layerRef.current)){map.addLayer(layerRef.current);}else if(!isVisible&&map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}}// Ajouter les marqueurs au LayerGroup seulement si la couche est visible\nif(isVisible){sites.forEach(site=>{// V�rifier si les coordonn�es sont g�n�r�es\nconst isGeneratedCoords=site.hasOwnProperty('isGeneratedCoordinates')&&site.isGeneratedCoordinates===true;if(!showGeneratedCoordinates&&isGeneratedCoords){return;}if(site.latitude&&site.longitude){var _layerRef$current;const siteIcon=getIconForSiteType(site.type||'');const marker=L.marker([site.latitude,site.longitude],{icon:siteIcon}).bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole||'Non d�fini'}</p>\n                ${isGeneratedCoords?'<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>':''}\n              </div>\n            `);if(showLabels){marker.bindTooltip(site.nom,{permanent:true,direction:'top',className:'site-label'});}(_layerRef$current=layerRef.current)===null||_layerRef$current===void 0?void 0:_layerRef$current.addLayer(marker);}});}// Nettoyer le LayerGroup lors du d�montage du composant\nreturn()=>{if(layerRef.current){if(map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}layerRef.current=null;}};},[sites,icon,getIconForSiteType,showLabels,showGeneratedCoordinates,map,isVisible]);// G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\nuseEffect(()=>{const handleLayerControlChange=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling,_nextSibling$textCont;if(((_nextSibling=checkbox.nextSibling)===null||_nextSibling===void 0?void 0:(_nextSibling$textCont=_nextSibling.textContent)===null||_nextSibling$textCont===void 0?void 0:_nextSibling$textCont.trim())==='Tous les sites'){// Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\nsetIsVisible(checkbox.checked);// Ajouter un �couteur d'�v�nements pour les changements futurs\ncheckbox.addEventListener('change',e=>{const isChecked=e.target.checked;setIsVisible(isChecked);});}});}};// Attendre que le contr�le des couches soit ajout�  la carte\nconst checkLayersControl=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){handleLayerControlChange();}else{// Si le contr�le n'est pas encore disponible, r�essayer plus tard\nsetTimeout(checkLayersControl,100);}};checkLayersControl();// Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\nreturn()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling2,_nextSibling2$textCon;if(((_nextSibling2=checkbox.nextSibling)===null||_nextSibling2===void 0?void 0:(_nextSibling2$textCon=_nextSibling2.textContent)===null||_nextSibling2$textCon===void 0?void 0:_nextSibling2$textCon.trim())==='Tous les sites'){checkbox.removeEventListener('change',()=>{});}});}};},[map]);return null;};// Composant pour afficher les sites par type\nconst SiteTypeLayer=_ref2=>{let{sites,icon,type,getIconForSiteType,showLabels,showGeneratedCoordinates}=_ref2;const map=useMap();const layerRef=useRef(null);const[isVisible,setIsVisible]=useState(true);useEffect(()=>{// Cr�er un nouveau LayerGroup si n�cessaire\nif(!layerRef.current){layerRef.current=L.layerGroup();// Ajouter le LayerGroup �  la carte si la couche est visible\nif(isVisible){layerRef.current.addTo(map);}}else{// Sinon, vider le LayerGroup existant\nlayerRef.current.clearLayers();// Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\nif(isVisible&&!map.hasLayer(layerRef.current)){map.addLayer(layerRef.current);}else if(!isVisible&&map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}}// Ajouter les marqueurs au LayerGroup seulement si la couche est visible\nif(isVisible){// Filtrer les sites par type et ajouter les marqueurs au LayerGroup\nconst filteredSites=sites.filter(site=>normalizeType(site.type||'')===normalizeType(type));filteredSites.forEach(site=>{// V�rifier si les coordonn�es sont g�n�r�es\nconst isGeneratedCoords=site.hasOwnProperty('isGeneratedCoordinates')&&site.isGeneratedCoordinates===true;if(!showGeneratedCoordinates&&isGeneratedCoords){return;}if(site.latitude&&site.longitude){var _layerRef$current2;const siteIcon=getIconForSiteType(site.type||'');const marker=L.marker([site.latitude,site.longitude],{icon:siteIcon}).bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole||'Non d�fini'}</p>\n                ${isGeneratedCoords?'<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>':''}\n              </div>\n            `);if(showLabels){marker.bindTooltip(site.nom,{permanent:true,direction:'top',className:'site-label'});}(_layerRef$current2=layerRef.current)===null||_layerRef$current2===void 0?void 0:_layerRef$current2.addLayer(marker);}});}// Nettoyer le LayerGroup lors du d�montage du composant\nreturn()=>{if(layerRef.current){if(map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}layerRef.current=null;}};},[sites,icon,type,getIconForSiteType,showLabels,showGeneratedCoordinates,map,isVisible]);// G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\nuseEffect(()=>{const handleLayerControlChange=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling3,_nextSibling3$textCon;if(((_nextSibling3=checkbox.nextSibling)===null||_nextSibling3===void 0?void 0:(_nextSibling3$textCon=_nextSibling3.textContent)===null||_nextSibling3$textCon===void 0?void 0:_nextSibling3$textCon.trim())===type){// Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\nsetIsVisible(checkbox.checked);// Ajouter un �couteur d'�v�nements pour les changements futurs\ncheckbox.addEventListener('change',e=>{const isChecked=e.target.checked;setIsVisible(isChecked);});}});}};// Attendre que le contr�le des couches soit ajout�  la carte\nconst checkLayersControl=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){handleLayerControlChange();}else{// Si le contr�le n'est pas encore disponible, r�essayer plus tard\nsetTimeout(checkLayersControl,100);}};checkLayersControl();// Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\nreturn()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling4,_nextSibling4$textCon;if(((_nextSibling4=checkbox.nextSibling)===null||_nextSibling4===void 0?void 0:(_nextSibling4$textCon=_nextSibling4.textContent)===null||_nextSibling4$textCon===void 0?void 0:_nextSibling4$textCon.trim())===type){checkbox.removeEventListener('change',()=>{});}});}};},[map,type]);return null;};// Composant pour afficher les sites par p�le\nconst PoleLayer=_ref3=>{let{sites,icon,pole,getIconForSiteType,showLabels,showGeneratedCoordinates}=_ref3;const map=useMap();const layerRef=useRef(null);const[isVisible,setIsVisible]=useState(true);useEffect(()=>{// Cr�er un nouveau LayerGroup si n�cessaire\nif(!layerRef.current){layerRef.current=L.layerGroup();// Ajouter le LayerGroup �  la carte si la couche est visible\nif(isVisible){layerRef.current.addTo(map);}}else{// Sinon, vider le LayerGroup existant\nlayerRef.current.clearLayers();// Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\nif(isVisible&&!map.hasLayer(layerRef.current)){map.addLayer(layerRef.current);}else if(!isVisible&&map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}}// Ajouter les marqueurs au LayerGroup seulement si la couche est visible\nif(isVisible){// Filtrer les sites par p�le et ajouter les marqueurs au LayerGroup\nconst filteredSites=sites.filter(site=>site.pole===pole);filteredSites.forEach(site=>{// V�rifier si les coordonn�es sont g�n�r�es\nconst isGeneratedCoords=site.hasOwnProperty('isGeneratedCoordinates')&&site.isGeneratedCoordinates===true;if(!showGeneratedCoordinates&&isGeneratedCoords){return;}if(site.latitude&&site.longitude){var _layerRef$current3;const siteIcon=getIconForSiteType(site.type||'');const marker=L.marker([site.latitude,site.longitude],{icon:siteIcon}).bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole||'Non d�fini'}</p>\n                ${isGeneratedCoords?'<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>':''}\n              </div>\n            `);if(showLabels){marker.bindTooltip(site.nom,{permanent:true,direction:'top',className:'site-label'});}(_layerRef$current3=layerRef.current)===null||_layerRef$current3===void 0?void 0:_layerRef$current3.addLayer(marker);}});}// Nettoyer le LayerGroup lors du d�montage du composant\nreturn()=>{if(layerRef.current){if(map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}layerRef.current=null;}};},[sites,icon,pole,getIconForSiteType,showLabels,showGeneratedCoordinates,map,isVisible]);// G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\nuseEffect(()=>{const handleLayerControlChange=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling5,_nextSibling5$textCon;if(((_nextSibling5=checkbox.nextSibling)===null||_nextSibling5===void 0?void 0:(_nextSibling5$textCon=_nextSibling5.textContent)===null||_nextSibling5$textCon===void 0?void 0:_nextSibling5$textCon.trim())===`P�le ${pole}`){// Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\nsetIsVisible(checkbox.checked);// Ajouter un �couteur d'�v�nements pour les changements futurs\ncheckbox.addEventListener('change',e=>{const isChecked=e.target.checked;setIsVisible(isChecked);});}});}};// Attendre que le contr�le des couches soit ajout�  la carte\nconst checkLayersControl=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){handleLayerControlChange();}else{// Si le contr�le n'est pas encore disponible, r�essayer plus tard\nsetTimeout(checkLayersControl,100);}};checkLayersControl();// Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\nreturn()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling6,_nextSibling6$textCon;if(((_nextSibling6=checkbox.nextSibling)===null||_nextSibling6===void 0?void 0:(_nextSibling6$textCon=_nextSibling6.textContent)===null||_nextSibling6$textCon===void 0?void 0:_nextSibling6$textCon.trim())===`P�le ${pole}`){checkbox.removeEventListener('change',()=>{});}});}};},[map,pole]);return null;};// Composant pour afficher les coursiers\nconst CouriersLayer=_ref4=>{let{courierLocations,departIcon,arrivalIcon,formatDate}=_ref4;const map=useMap();const layerRef=useRef(null);const[isVisible,setIsVisible]=useState(true);useEffect(()=>{// Cr�er un nouveau LayerGroup si n�cessaire\nif(!layerRef.current){layerRef.current=L.layerGroup();// Ajouter le LayerGroup �  la carte si la couche est visible\nif(isVisible){layerRef.current.addTo(map);}}else{// Sinon, vider le LayerGroup existant\nlayerRef.current.clearLayers();// Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\nif(isVisible&&!map.hasLayer(layerRef.current)){map.addLayer(layerRef.current);}else if(!isVisible&&map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}}// Ajouter les marqueurs des coursiers au LayerGroup seulement si la couche est visible\nif(isVisible){courierLocations.forEach(courier=>{var _layerRef$current4;const icon=courier.isArrival?arrivalIcon:departIcon;const marker=L.marker([courier.latitude,courier.longitude],{icon}).bindPopup(`\n            <div class=\"courier-popup\">\n              <h3>${courier.nom}</h3>\n              <p><strong>Tourn�e:</strong> ${courier.tourneeName}</p>\n              <p><strong>Dernier scan:</strong> ${formatDate(courier.lastScan)}</p>\n              <p><strong>Site:</strong> ${courier.siteName}</p>\n              <p><strong>Statut:</strong> ${courier.isArrival?'Arriv�e':'D�part'}</p>\n            </div>\n          `);(_layerRef$current4=layerRef.current)===null||_layerRef$current4===void 0?void 0:_layerRef$current4.addLayer(marker);});}// Nettoyer le LayerGroup lors du d�montage du composant\nreturn()=>{if(layerRef.current){if(map.hasLayer(layerRef.current)){map.removeLayer(layerRef.current);}layerRef.current=null;}};},[courierLocations,departIcon,arrivalIcon,formatDate,map,isVisible]);// G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\nuseEffect(()=>{const handleLayerControlChange=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling7,_nextSibling7$textCon;if(((_nextSibling7=checkbox.nextSibling)===null||_nextSibling7===void 0?void 0:(_nextSibling7$textCon=_nextSibling7.textContent)===null||_nextSibling7$textCon===void 0?void 0:_nextSibling7$textCon.trim())==='Coursiers'){// Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\nsetIsVisible(checkbox.checked);// Ajouter un �couteur d'�v�nements pour les changements futurs\ncheckbox.addEventListener('change',e=>{const isChecked=e.target.checked;setIsVisible(isChecked);});}});}};// Attendre que le contr�le des couches soit ajout�  la carte\nconst checkLayersControl=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){handleLayerControlChange();}else{// Si le contr�le n'est pas encore disponible, r�essayer plus tard\nsetTimeout(checkLayersControl,100);}};checkLayersControl();// Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\nreturn()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){const checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{var _nextSibling8,_nextSibling8$textCon;if(((_nextSibling8=checkbox.nextSibling)===null||_nextSibling8===void 0?void 0:(_nextSibling8$textCon=_nextSibling8.textContent)===null||_nextSibling8$textCon===void 0?void 0:_nextSibling8$textCon.trim())==='Coursiers'){checkbox.removeEventListener('change',()=>{});}});}};},[map]);return null;};// Composant pour g�rer les animations des marqueurs\nconst AnimatedMarker=_ref5=>{let{position,icon,popup,markerId}=_ref5;const markerRef=useRef(null);const map=useMap();useEffect(()=>{if(markerRef.current){const marker=markerRef.current;const currentPos=marker.getLatLng();const targetPos=L.latLng(position[0],position[1]);// Animation fluide si le marqueur existe d�j� \nif(currentPos&&!currentPos.equals(targetPos)){marker.slideTo(targetPos,{duration:1000,keepAtCenter:false});}}},[position]);return/*#__PURE__*/_jsx(Marker,{position:position,icon:icon,ref:markerRef,children:popup});};// Coordonn�es du centre de la France\nconst franceCenter=[46.603354,1.888334];// Fonction pour g�n�rer des coordonn�es pour un site sans coordonn�es\nconst generateCoordinates=(site,index)=>{// Coordonn�es de base (centre de la France)\nconst baseLatitude=46.603354;const baseLongitude=1.888334;// Si le site a un code postal, utiliser les deux premiers chiffres pour g�n�rer des coordonn�es\nif(site.codePostal&&site.codePostal.length>=2){const departement=parseInt(site.codePostal.substring(0,2),10);// Carte approximative des d�partements fran�ais (latitude et longitude)\n// Nous utilisons le num�ro de d�partement pour g�n�rer des coordonn�es approximatives\nconst latOffset=(departement%10-5)*0.5;// -2.5 �  +2.5 degr�s\nconst lonOffset=(Math.floor(departement/10)%10-5)*0.5;// -2.5 �  +2.5 degr�s\n// Ajouter un petit d�calage pour chaque site dans le m�me d�partement\nconst siteOffset=index*0.01;return[baseLatitude+latOffset+siteOffset,baseLongitude+lonOffset+siteOffset];}// Si le site a une ville mais pas de code postal, utiliser la premi�re lettre de la ville\nif(site.ville){const firstLetter=site.ville.charAt(0).toUpperCase();const letterCode=firstLetter.charCodeAt(0)-65;// A=0, B=1, etc.\n// Utiliser le code de la lettre pour g�n�rer des coordonn�es\nconst latOffset=(letterCode%5-2)*0.5;// -1 �  +1 degr�s\nconst lonOffset=(Math.floor(letterCode/5)%5-2)*0.5;// -1 �  +1 degr�s\n// Ajouter un petit d�calage pour chaque site dans la m�me ville\nconst siteOffset=index*0.01;return[baseLatitude+latOffset+siteOffset,baseLongitude+lonOffset+siteOffset];}// Si le site n'a ni code postal ni ville, utiliser un d�calage bas� sur l'index\nreturn[baseLatitude+index*0.01,baseLongitude+index*0.01];};// Composant pour la l�gende des sites\nconst SiteLegend=()=>{const map=useMap();const[markerPreferences,setMarkerPreferences]=useState([]);const legendControlRef=useRef(null);const updateTimerRef=useRef(null);// Utiliser useMemo pour �viter les recalculs inutiles du contenu de la l�gende\nconst legendContent=useMemo(()=>{// Utiliser les pr�f�rences de marqueurs si disponibles\nconst legendItems=markerPreferences.length>0?markerPreferences.map(pref=>`\n          <div class=\"site-legend-item\">\n            <div class=\"site-legend-color\" style=\"background-color: ${pref.color};\"></div>\n            <div class=\"site-legend-label\">${pref.name}</div>\n          </div>\n        `).join(''):`\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-laboratoire\"></div>\n          <div class=\"site-legend-label\">Laboratoire</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-clinique\"></div>\n          <div class=\"site-legend-label\">Clinique</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-plateau\"></div>\n          <div class=\"site-legend-label\">Plateau technique</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-collecte\"></div>\n          <div class=\"site-legend-label\">Point de collecte</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-etablissement\"></div>\n          <div class=\"site-legend-label\">�tablissement de sant�</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-ehpad\"></div>\n          <div class=\"site-legend-label\">Ehpad</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-veterinaire\"></div>\n          <div class=\"site-legend-label\">V�t�rinaire</div>\n        </div>\n      `;return`\n      ${legendItems}\n      <div class=\"site-legend-item generated\">\n        <div class=\"site-legend-color\" style=\"border: 2px dashed red; opacity: 0.6;\"></div>\n        <div class=\"site-legend-label\">Coordonn�es g�n�r�es</div>\n      </div>\n    `;},[markerPreferences]);useEffect(()=>{// R�cup�rer les pr�f�rences de marqueurs une seule fois\nconst fetchPreferences=async()=>{try{const preferencesRef=collection(db,'markerPreferences');const snapshot=await getDocs(preferencesRef);if(!snapshot.empty){const preferencesData=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setMarkerPreferences(preferencesData);// Utiliser un niveau de log moins verbeux\nconsole.debug(`L�gende: ${preferencesData.length} pr�f�rences de marqueurs charg�es`);}}catch(error){console.error('Erreur lors de la r�cup�ration des pr�f�rences de marqueurs pour la l�gende:',error);}};fetchPreferences();// Cr�er un contr�le personnalis� pour la l�gende une seule fois\nif(!legendControlRef.current){const LegendControl=L.Control.extend({options:{position:'bottomright'},onAdd:function(map){const div=L.DomUtil.create('div','info legend site-legend');div.innerHTML=`\n            <h4>Types de sites</h4>\n            <div class=\"site-legend-items\">Chargement...</div>\n          `;return div;}});// Ajouter le contr�le �  la carte une seule fois\nlegendControlRef.current=new LegendControl();map.addControl(legendControlRef.current);}// Mettre �  jour le contenu de la l�gende\nconst updateLegendContent=()=>{if(!legendControlRef.current||!legendControlRef.current._container)return;const legendContainer=legendControlRef.current._container.querySelector('.site-legend-items');if(!legendContainer)return;legendContainer.innerHTML=legendContent;};// Mettre �  jour le contenu initial\nupdateLegendContent();// Configurer un �couteur pour les changements dans les pr�f�rences de marqueurs\n// avec une fr�quence limit�e pour �viter les mises �  jour trop fr�quentes\nconst preferencesRef=collection(db,'markerPreferences');const unsubscribe=onSnapshot(preferencesRef,snapshot=>{// Annuler la mise �  jour pr�c�dente si elle est en attente\nif(updateTimerRef.current!==null){clearTimeout(updateTimerRef.current);}// Planifier une nouvelle mise �  jour avec un d�lai pour limiter la fr�quence\nupdateTimerRef.current=window.setTimeout(()=>{const preferencesData=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setMarkerPreferences(preferencesData);// Utiliser un niveau de log moins verbeux et limiter les informations affich�es\nif(import.meta.env.DEV){console.debug(`Mise � jour de la l�gende: ${preferencesData.length} pr�f�rences`);}updateTimerRef.current=null;},1000);// Attendre 1 seconde avant de mettre �  jour\n});return()=>{unsubscribe();if(updateTimerRef.current!==null){clearTimeout(updateTimerRef.current);}};},[map,legendContent]);// Nettoyer le contr�le lors du d�montage final du composant\nuseEffect(()=>{return()=>{if(legendControlRef.current){map.removeControl(legendControlRef.current);legendControlRef.current=null;}};},[map]);return null;};// Composant pour les en-t�tes de section dans le contr�le des couches\nconst SectionHeader=_ref6=>{let{title}=_ref6;const map=useMap();useEffect(()=>{// Ajouter un style personnalis� apr�s le rendu du composant\nconst addCustomStyle=()=>{const labels=document.querySelectorAll('.leaflet-control-layers-overlays label');labels.forEach(label=>{const span=label.querySelector('span');if(span&&span.textContent===title){label.classList.add('layer-section-header');const checkbox=label.querySelector('input[type=\"checkbox\"]');if(checkbox){checkbox.disabled=true;checkbox.style.display='none';}}});};// Ex�cuter apr�s un court d�lai pour s'assurer que le DOM est mis �  jour\nsetTimeout(addCustomStyle,100);// Observer les changements dans le contr�le de couches\nconst observer=new MutationObserver(addCustomStyle);const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){observer.observe(layersControl,{childList:true,subtree:true});}return()=>{observer.disconnect();};},[title]);return/*#__PURE__*/_jsx(LayerGroup,{});};// Composant pour ajouter le contr�le des libell�s et des filtres personnalis�s\nconst MapControls=_ref7=>{let{showLabels,setShowLabels,sites,setSiteFilter,currentFilter,showGeneratedCoordinates,setShowGeneratedCoordinates,onZoomToSite}=_ref7;const map=useMap();const[searchTerm,setSearchTerm]=useState('');const[filtersVisible,setFiltersVisible]=useState(false);const[searchResults,setSearchResults]=useState([]);// Mettre �  jour les r�sultats de recherche lorsque le terme de recherche change\nuseEffect(()=>{if(!searchTerm){setSearchResults([]);return;}const normalizedSearch=searchTerm.toLowerCase();const results=sites.filter(site=>{var _site$nom,_site$adresse,_site$ville,_site$codePostal,_site$type;return((_site$nom=site.nom)===null||_site$nom===void 0?void 0:_site$nom.toLowerCase().includes(normalizedSearch))||((_site$adresse=site.adresse)===null||_site$adresse===void 0?void 0:_site$adresse.toLowerCase().includes(normalizedSearch))||((_site$ville=site.ville)===null||_site$ville===void 0?void 0:_site$ville.toLowerCase().includes(normalizedSearch))||((_site$codePostal=site.codePostal)===null||_site$codePostal===void 0?void 0:_site$codePostal.includes(normalizedSearch))||((_site$type=site.type)===null||_site$type===void 0?void 0:_site$type.toLowerCase().includes(normalizedSearch));}).slice(0,5);// Limiter �  5 r�sultats\nsetSearchResults(results);},[searchTerm,sites]);useEffect(()=>{// Cr�er un contr�le personnalis�\nconst MapControlsControl=L.Control.extend({options:{position:'topleft'},onAdd:function(){const container=L.DomUtil.create('div','leaflet-bar leaflet-control map-custom-controls');// Bouton pour activer/d�sactiver les libell�s\nconst labelsButton=L.DomUtil.create('a','leaflet-control-labels',container);labelsButton.innerHTML='<i class=\"fas fa-tag\"></i>';labelsButton.href='#';labelsButton.title=showLabels?'Masquer les libell�s':'Afficher les libell�s';labelsButton.setAttribute('role','button');labelsButton.setAttribute('aria-label',showLabels?'Masquer les libell�s':'Afficher les libell�s');if(showLabels){labelsButton.classList.add('active');}L.DomEvent.on(labelsButton,'click',function(e){L.DomEvent.preventDefault(e);setShowLabels(!showLabels);labelsButton.title=!showLabels?'Masquer les libell�s':'Afficher les libell�s';labelsButton.classList.toggle('active');});// Cr�er un conteneur pour les filtres\nconst filtersContainer=L.DomUtil.create('div','map-filters-container',container);filtersContainer.style.display=filtersVisible?'block':'none';// Ajouter un titre\nconst filterTitle=L.DomUtil.create('div','map-filter-title',filtersContainer);filterTitle.textContent='Filtres';// Ajouter un champ de recherche\nconst searchContainer=L.DomUtil.create('div','map-filter-search',filtersContainer);const searchInput=L.DomUtil.create('input','map-filter-search-input',searchContainer);searchInput.type='text';searchInput.placeholder='Rechercher un site...';searchInput.value=searchTerm;// Conteneur pour les r�sultats de recherche\nconst searchResultsContainer=L.DomUtil.create('div','map-search-results',filtersContainer);searchResultsContainer.style.display='none';// Mettre �  jour les r�sultats de recherche\nconst updateSearchResults=()=>{searchResultsContainer.innerHTML='';if(searchResults.length===0){if(searchTerm){searchResultsContainer.innerHTML='<div class=\"map-search-no-results\">Aucun r�sultat trouv�</div>';searchResultsContainer.style.display='block';}else{searchResultsContainer.style.display='none';}return;}searchResultsContainer.style.display='block';searchResults.forEach(site=>{const resultItem=L.DomUtil.create('div','map-search-result-item',searchResultsContainer);resultItem.innerHTML=`\n              <div class=\"map-search-result-name\">${site.nom}</div>\n              <div class=\"map-search-result-details\">\n                ${site.type?`<span>${site.type}</span>`:''}\n                ${site.ville?`<span>${site.ville}</span>`:''}\n              </div>\n            `;L.DomEvent.on(resultItem,'click',function(){onZoomToSite(site);searchResultsContainer.style.display='none';setSearchTerm('');searchInput.value='';});});};// Mettre �  jour les r�sultats initiaux\nupdateSearchResults();// Mettre �  jour les r�sultats lorsqu'ils changent\nconst observer=new MutationObserver(()=>{updateSearchResults();});L.DomEvent.on(searchInput,'input',function(e){setSearchTerm(e.target.value);if(e.target.value){setSiteFilter(e.target.value);}else{setSiteFilter(null);searchResultsContainer.style.display='none';}});// Ajouter une option pour afficher/masquer les coordonn�es g�n�r�es\nconst generatedCoordsContainer=L.DomUtil.create('div','map-filter-option',filtersContainer);const generatedCoordsCheckbox=L.DomUtil.create('input','',generatedCoordsContainer);generatedCoordsCheckbox.type='checkbox';generatedCoordsCheckbox.id='show-generated-coords';generatedCoordsCheckbox.checked=showGeneratedCoordinates;const generatedCoordsLabel=L.DomUtil.create('label','',generatedCoordsContainer);generatedCoordsLabel.htmlFor='show-generated-coords';generatedCoordsLabel.textContent='Afficher les coordonn�es g�n�r�es';L.DomEvent.on(generatedCoordsCheckbox,'change',function(e){setShowGeneratedCoordinates(e.target.checked);});// Bouton pour afficher/masquer les filtres\nconst filtersButton=L.DomUtil.create('a','leaflet-control-filters',container);filtersButton.innerHTML='<i class=\"fas fa-filter\"></i>';filtersButton.href='#';filtersButton.title='Filtres avanc�s';filtersButton.setAttribute('role','button');filtersButton.setAttribute('aria-label','Filtres avanc�s');if(filtersVisible){filtersButton.classList.add('active');}L.DomEvent.on(filtersButton,'click',function(e){L.DomEvent.preventDefault(e);setFiltersVisible(!filtersVisible);filtersContainer.style.display=filtersVisible?'block':'none';filtersButton.classList.toggle('active');});// Emp�cher la propagation des �v�nements pour �viter que la carte ne se d�place\nL.DomEvent.disableClickPropagation(container);L.DomEvent.disableScrollPropagation(container);return container;}});// Ajouter le contr�le �  la carte\nconst mapControlsControl=new MapControlsControl();map.addControl(mapControlsControl);return()=>{map.removeControl(mapControlsControl);};},[map,showLabels,setShowLabels,sites,setSiteFilter,currentFilter,searchTerm,filtersVisible,showGeneratedCoordinates,setShowGeneratedCoordinates,searchResults,onZoomToSite]);return null;};// Composant pour initialiser les �v�nements des couches\nconst LayersEventInitializer=()=>{const map=useMap();useEffect(()=>{// Initialiser le contr�le des couches\nconst initLayersControl=()=>{const layersControl=document.querySelector('.leaflet-control-layers');if(layersControl){// S'assurer que toutes les cases �  cocher sont coch�es par d�faut\nconst checkboxes=layersControl.querySelectorAll('input[type=\"checkbox\"]');checkboxes.forEach(checkbox=>{checkbox.checked=true;});// D�clencher un �v�nement change sur chaque case �  cocher pour activer les couches\ncheckboxes.forEach(checkbox=>{const event=new Event('change',{bubbles:true});checkbox.dispatchEvent(event);});// Ajouter des s�parateurs visuels pour les sections\nconst overlaysContainer=layersControl.querySelector('.leaflet-control-layers-overlays');if(overlaysContainer){const labels=overlaysContainer.querySelectorAll('label');labels.forEach(label=>{var _label$textContent;const text=(_label$textContent=label.textContent)===null||_label$textContent===void 0?void 0:_label$textContent.trim();if(text&&text.startsWith('---')){var _label$parentNode;// Cr�er un �l�ment de s�paration\nconst separator=document.createElement('div');separator.className='layer-section-header';separator.innerHTML=`<span>${text.replace(/^---\\s*/,'')}</span>`;// Remplacer le label par le s�parateur\n(_label$parentNode=label.parentNode)===null||_label$parentNode===void 0?void 0:_label$parentNode.replaceChild(separator,label);}});}}else{// Si le contr�le n'est pas encore disponible, r�essayer plus tard\nsetTimeout(initLayersControl,100);}};// Attendre que la carte soit charg�e avant d'initialiser le contr�le des couches\nsetTimeout(initLayersControl,500);return()=>{// Nettoyer les �couteurs d'�v�nements si n�cessaire\n};},[map]);return null;};// Composant pour corriger manuellement les coordonn�es d'un site\nconst ManualCoordinatesCorrection=_ref8=>{let{sites,onCoordinatesUpdated}=_ref8;const map=useMap();const[isActive,setIsActive]=useState(false);const[selectedSite,setSelectedSite]=useState(null);const[searchTerm,setSearchTerm]=useState('');const[searchResults,setSearchResults]=useState([]);const markerRef=useRef(null);// Filtrer les sites en fonction du terme de recherche\nuseEffect(()=>{if(!searchTerm){setSearchResults([]);return;}const normalizedSearch=searchTerm.toLowerCase();const results=sites.filter(site=>{var _site$nom2,_site$adresse2,_site$ville2,_site$codePostal2;return((_site$nom2=site.nom)===null||_site$nom2===void 0?void 0:_site$nom2.toLowerCase().includes(normalizedSearch))||((_site$adresse2=site.adresse)===null||_site$adresse2===void 0?void 0:_site$adresse2.toLowerCase().includes(normalizedSearch))||((_site$ville2=site.ville)===null||_site$ville2===void 0?void 0:_site$ville2.toLowerCase().includes(normalizedSearch))||((_site$codePostal2=site.codePostal)===null||_site$codePostal2===void 0?void 0:_site$codePostal2.includes(normalizedSearch));}).slice(0,10);// Limiter �  10 r�sultats\nsetSearchResults(results);},[searchTerm,sites]);// Fonction pour s�lectionner un site\nconst selectSite=site=>{setSelectedSite(site);setSearchTerm('');setSearchResults([]);if(site.latitude&&site.longitude){// Centrer la carte sur le site\nmap.setView([site.latitude,site.longitude],15);// Cr�er un marqueur d�pla�able\nif(markerRef.current){map.removeLayer(markerRef.current);}const marker=L.marker([site.latitude,site.longitude],{draggable:true,icon:L.divIcon({className:'correction-marker',html:`<div style=\"background-color: red; width: 24px; height: 24px; border-radius: 50%; \ndisplay: flex; justify-content: center; align-items: center; box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);\">\n                  <i class=\"fas fa-map-marker-alt\" style=\"color: white; font-size: 14px;\"></i>\n                </div>`,iconSize:[24,24],iconAnchor:[12,12]})}).addTo(map);// Ajouter un popup avec les informations du site\nmarker.bindPopup(`\n        <div>\n          <strong>${site.nom}</strong><br>\n          ${site.adresse}<br>\n          ${site.codePostal} ${site.ville||''}\n        </div>\n      `).openPopup();// Mettre �  jour les coordonn�es lorsque le marqueur est d�plac�\nmarker.on('dragend',e=>{const newLatLng=marker.getLatLng();console.log(`Nouvelles coordonn�es pour ${site.nom}: Lat=${newLatLng.lat}, Lng=${newLatLng.lng}`);});markerRef.current=marker;}else{alert(`Le site \"${site.nom}\" n'a pas de coordonn�es. Veuillez d'abord le g�ocoder.`);}};// Fonction pour enregistrer les nouvelles coordonn�es\nconst saveCoordinates=()=>{if(selectedSite&&markerRef.current){const newLatLng=markerRef.current.getLatLng();onCoordinatesUpdated(selectedSite.id,newLatLng.lat,newLatLng.lng);// Afficher un message de confirmation\nalert(`Les coordonn�es du site \"${selectedSite.nom}\" ont ét� mises �  jour.`);// R�initialiser\nmap.removeLayer(markerRef.current);markerRef.current=null;setSelectedSite(null);setIsActive(false);}};// Fonction pour annuler la correction\nconst cancelCorrection=()=>{if(markerRef.current){map.removeLayer(markerRef.current);markerRef.current=null;}setSelectedSite(null);setIsActive(false);};useEffect(()=>{// Cr�er un contr�le personnalis�\nconst CorrectionControl=L.Control.extend({options:{position:'topleft'},onAdd:function(){const container=L.DomUtil.create('div','leaflet-bar leaflet-control correction-control');if(!isActive){// Bouton pour activer la correction\nconst button=L.DomUtil.create('a','correction-button',container);button.innerHTML='<i class=\"fas fa-map-marker-alt\"></i>';button.href='#';button.title='Corriger les coordonn�es d\\'un site';L.DomEvent.on(button,'click',function(e){L.DomEvent.preventDefault(e);setIsActive(true);});}else{// Interface de correction\nconst correctionPanel=L.DomUtil.create('div','correction-panel',container);// Titre\nconst title=L.DomUtil.create('div','correction-title',correctionPanel);title.textContent='Correction de coordonn�es';// Champ de recherche\nconst searchContainer=L.DomUtil.create('div','correction-search',correctionPanel);const searchInput=L.DomUtil.create('input','correction-search-input',searchContainer);searchInput.type='text';searchInput.placeholder='Rechercher un site...';searchInput.value=searchTerm;L.DomEvent.on(searchInput,'input',function(e){setSearchTerm(e.target.value);});// R�sultats de recherche\nif(searchResults.length>0){const resultsContainer=L.DomUtil.create('div','correction-results',correctionPanel);searchResults.forEach(site=>{const resultItem=L.DomUtil.create('div','correction-result-item',resultsContainer);resultItem.textContent=site.nom;L.DomEvent.on(resultItem,'click',function(){selectSite(site);});});}// Site s�lectionn�\nif(selectedSite){const selectedContainer=L.DomUtil.create('div','correction-selected',correctionPanel);const siteInfo=L.DomUtil.create('div','correction-site-info',selectedContainer);siteInfo.innerHTML=`\n              <strong>${selectedSite.nom}</strong><br>\n              ${selectedSite.adresse}<br>\n              ${selectedSite.codePostal} ${selectedSite.ville||''}\n            `;const instructions=L.DomUtil.create('div','correction-instructions',selectedContainer);instructions.textContent='D�placez le marqueur rouge � la position correcte, puis cliquez sur \"Enregistrer\".';const buttonsContainer=L.DomUtil.create('div','correction-buttons',selectedContainer);const saveButton=L.DomUtil.create('button','correction-save-button',buttonsContainer);saveButton.textContent='Enregistrer';L.DomEvent.on(saveButton,'click',function(){saveCoordinates();});const cancelButton=L.DomUtil.create('button','correction-cancel-button',buttonsContainer);cancelButton.textContent='Annuler';L.DomEvent.on(cancelButton,'click',function(){cancelCorrection();});}// Bouton pour fermer le panneau\nif(!selectedSite){const closeButton=L.DomUtil.create('button','correction-close-button',correctionPanel);closeButton.textContent='Fermer';L.DomEvent.on(closeButton,'click',function(){setIsActive(false);});}}// Emp�cher la propagation des �v�nements pour �viter que la carte ne se d�place\nL.DomEvent.disableClickPropagation(container);L.DomEvent.disableScrollPropagation(container);return container;}});// Ajouter le contr�le �  la carte\nconst correctionControl=new CorrectionControl();map.addControl(correctionControl);return()=>{map.removeControl(correctionControl);if(markerRef.current){map.removeLayer(markerRef.current);markerRef.current=null;}};},[map,isActive,searchTerm,searchResults,selectedSite,sites,onCoordinatesUpdated]);return null;};// Composant de marqueur m�mo�s�\nconst MemoizedMarker=/*#__PURE__*/React.memo(_ref9=>{let{site,markerPreferences}=_ref9;// R�cup�rer l'ic�ne personnalis�e en fonction des pr�f�rences\nconst siteIcon=useMemo(()=>{const normalizedSiteType=normalizeType(site.type);const preference=markerPreferences.find(pref=>normalizeType(pref.siteType)===normalizedSiteType);if(preference){return L.divIcon({className:'custom-div-icon',html:`\n          <div style=\"background-color: ${preference.color}; \n                      width: 24px; \n                      height: 24px; \n                      border-radius: 50%; \n                      display: flex; \n                      justify-content: center; \n                      align-items: center; \n                      box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);\">\n            <i class=\"fas ${getIconClassForType(preference.icon)}\" \n               style=\"color: white; font-size: 14px;\"></i>\n          </div>\n        `,iconSize:[24,24],iconAnchor:[12,12]});}return getDefaultIconForSiteType(site.type);},[site.type,markerPreferences]);if(!site.latitude||!site.longitude)return null;return/*#__PURE__*/_jsx(Marker,{position:[site.latitude,site.longitude],icon:siteIcon,children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:site.nom}),/*#__PURE__*/_jsx(\"br\",{}),site.adresse,/*#__PURE__*/_jsx(\"br\",{}),site.ville,\" \",site.codePostal,/*#__PURE__*/_jsx(\"br\",{}),\"Type: \",site.type]})})},site.id);},(prevProps,nextProps)=>{// Comparaison personnalis�e pour �viter les re-rendus inutiles\nreturn prevProps.site.id===nextProps.site.id&&prevProps.site.latitude===nextProps.site.latitude&&prevProps.site.longitude===nextProps.site.longitude&&prevProps.site.type===nextProps.site.type&&JSON.stringify(prevProps.markerPreferences)===JSON.stringify(nextProps.markerPreferences);});// Composant de clustering dynamique\nconst SiteLayer=_ref10=>{let{sites,visibleTypes=[],maxMarkers=500}=_ref10;const map=useMap();const[currentZoom,setCurrentZoom]=useState(8);const[visibleSites,setVisibleSites]=useState([]);const[markerPreferences,setMarkerPreferences]=useState([]);// Mettre � jour le zoom lors des changements de la carte\nuseEffect(()=>{if(!map)return;const updateZoom=()=>{setCurrentZoom(map.getZoom());};map.on('zoomend',updateZoom);return()=>{map.off('zoomend',updateZoom);};},[map]);// Charger les pr�f�rences de marqueurs\nuseEffect(()=>{const fetchPreferences=async()=>{try{const preferencesRef=collection(db,'markerPreferences');const snapshot=await getDocs(preferencesRef);const preferencesData=snapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setMarkerPreferences(preferencesData);}catch(error){console.error('Erreur lors du chargement des pr�f�rences de marqueurs:',error);}};fetchPreferences();},[]);// Filtrage et pagination des sites\nconst filteredSites=useMemo(()=>{return sites.filter(site=>{const normalizedSiteType=normalizeType(site.type);// Si aucun type n'est s�lectionn�, afficher tous les sites\nif(visibleTypes.length===0){return site.latitude&&site.longitude;}// V�rifier si le type de site est dans les types s�lectionn�s\nconst isTypeVisible=visibleTypes.some(selectedType=>normalizedSiteType===normalizeType(selectedType));return isTypeVisible&&site.latitude&&site.longitude;});},[sites,visibleTypes]);// Mettre � jour les sites visibles\nuseEffect(()=>{const sitesToShow=filteredSites.slice(0,maxMarkers);setVisibleSites(sitesToShow);// Ajuster la vue de la carte\nif(map&&sitesToShow.length>0){const coordinates=sitesToShow.map(site=>[site.latitude,site.longitude]).filter(coords=>coords[0]!==undefined&&coords[1]!==undefined&&!isNaN(coords[0])&&!isNaN(coords[1]));if(coordinates.length>0){const bounds=L.latLngBounds(coordinates);map.fitBounds(bounds,{padding:[50,50],maxZoom:12});}}},[filteredSites,map,maxMarkers]);// Clustering personnalis�\nconst renderMarkers=useMemo(()=>{// Si le nombre de sites est faible, afficher tous les marqueurs\nif(visibleSites.length<=50){return visibleSites.map(site=>/*#__PURE__*/_jsx(MemoizedMarker,{site:site,markerPreferences:markerPreferences},site.id));}// Clustering dynamique bas� sur le niveau de zoom\nconst currentZoom=map?map.getZoom():8;// Zoom par d�faut\nconst clusterThreshold=12;// Niveau de zoom o� le clustering commence � se d�sagr�ger\nconst clusterRadius=currentZoom<clusterThreshold?0.2// Rayon de clustering plus grand pour les zooms �loign�s\n:0.05;// Rayon plus petit pour un d�groupement plus pr�coce\nconst clusters={};visibleSites.forEach(site=>{if(!site.latitude||!site.longitude)return;let clustered=false;for(const clusterKey in clusters){const[clusterLat,clusterLng]=clusterKey.split(',').map(Number);const distance=Math.sqrt(Math.pow(site.latitude-clusterLat,2)+Math.pow(site.longitude-clusterLng,2));// Ajuster la logique de clustering en fonction du zoom\nif(distance<clusterRadius){clusters[clusterKey].push(site);clustered=true;break;}}if(!clustered){const newClusterKey=`${site.latitude.toFixed(1)},${site.longitude.toFixed(1)}`;clusters[newClusterKey]=[site];}});// Rendu des clusters\nreturn Object.entries(clusters).flatMap(_ref11=>{let[key,clusterSites]=_ref11;// D�grouper plus t�t si le zoom est suffisant\nif(currentZoom>=clusterThreshold||clusterSites.length<=3){return clusterSites.map(site=>/*#__PURE__*/_jsx(MemoizedMarker,{site:site,markerPreferences:markerPreferences},site.id));}// Cluster avec plusieurs sites\nconst validSites=clusterSites.filter(site=>site.latitude!==undefined&&site.longitude!==undefined);if(validSites.length===0)return[];const centerLat=validSites.reduce((sum,site)=>sum+(site.latitude||0),0)/validSites.length;const centerLng=validSites.reduce((sum,site)=>sum+(site.longitude||0),0)/validSites.length;// D�terminer l'ic�ne et la couleur du cluster\nconst clusterPreference=markerPreferences.find(pref=>normalizeType(pref.siteType)===normalizeType(validSites[0].type));return[/*#__PURE__*/_jsx(Marker,{position:[centerLat,centerLng],icon:L.divIcon({className:'marker-cluster',html:`\n              <div style=\"\n                background-color: ${(clusterPreference===null||clusterPreference===void 0?void 0:clusterPreference.color)||'gray'}; \n                width: 40px; \n                height: 40px; \n                border-radius: 50%; \n                display: flex; \n                justify-content: center; \n                align-items: center; \n                color: white; \n                font-weight: bold;\n                box-shadow: 0 0 5px rgba(0,0,0,0.3);\n                opacity: ${currentZoom<clusterThreshold?1:0.7};\n              \">\n                ${clusterSites.length}\n              </div>\n            `,iconSize:L.point(40,40)}),children:/*#__PURE__*/_jsx(Popup,{children:/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"strong\",{children:[\"Cluster de \",clusterSites.length,\" sites\"]}),/*#__PURE__*/_jsxs(\"ul\",{children:[clusterSites.slice(0,5).map(site=>/*#__PURE__*/_jsx(\"li\",{children:site.nom},site.id)),clusterSites.length>5&&/*#__PURE__*/_jsxs(\"li\",{children:[\"... et \",clusterSites.length-5,\" autres\"]})]})]})})},`cluster-${key}`)];});},[visibleSites,markerPreferences,map,currentZoom]);return/*#__PURE__*/_jsx(_Fragment,{children:renderMarkers});};const MapView=()=>{const[sites,setSites]=useState([]);const[selectedTypes,setSelectedTypes]=useState([]);const[markerPreferences,setMarkerPreferences]=useState([]);const mapRef=useRef(null);// Charger les sites et les pr�f�rences de marqueurs\nuseEffect(()=>{const loadData=async()=>{try{// Charger les sites\nconst sitesCollection=collection(db,'sites');const sitesSnapshot=await getDocs(sitesCollection);const loadedSites=sitesSnapshot.docs.map(doc=>({id:doc.id,...doc.data()}));// Filtrer les sites avec coordonn�es\nconst validSites=loadedSites.filter(site=>site.latitude&&site.longitude);setSites(validSites);// Charger les pr�f�rences de marqueurs\nconst preferencesRef=collection(db,'markerPreferences');const preferencesSnapshot=await getDocs(preferencesRef);const preferencesData=preferencesSnapshot.docs.map(doc=>({id:doc.id,...doc.data()}));setMarkerPreferences(preferencesData);}catch(error){console.error('Erreur lors du chargement des donn�es:',error);}};loadData();},[]);// Gestion des types de sites s�lectionn�s\nconst handleTypeToggle=type=>{setSelectedTypes(prev=>prev.includes(type)?prev.filter(t=>t!==type):[...prev,type]);};return/*#__PURE__*/_jsxs(MapContainer,{center:[43.6,3.8],zoom:8,style:{height:'100vh',width:'100%'},ref:ref=>{mapRef.current=ref;},children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors\"}),/*#__PURE__*/_jsx(FullscreenControl,{}),/*#__PURE__*/_jsxs(\"div\",{style:{position:'absolute',bottom:'20px',right:'20px',zIndex:1000,background:'white',padding:'10px',borderRadius:'5px',boxShadow:'0 2px 5px rgba(0,0,0,0.1)'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 10px 0',textAlign:'center'},children:\"Types de sites\"}),SITE_TYPES.map(type=>{const normalizedType=normalizeType(type);const preference=markerPreferences.find(pref=>normalizeType(pref.siteType)===normalizedType);return/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',marginBottom:'5px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{width:'20px',height:'20px',borderRadius:'50%',marginRight:'10px',backgroundColor:preference?preference.color:'gray',display:'flex',justifyContent:'center',alignItems:'center'},children:preference&&/*#__PURE__*/_jsx(\"i\",{className:`fas ${getIconClassForType(preference.icon)}`,style:{color:'white',fontSize:'12px'}})}),/*#__PURE__*/_jsx(\"span\",{children:type})]},type);})]}),/*#__PURE__*/_jsx(\"div\",{style:{position:'absolute',top:'10px',right:'10px',zIndex:1000,background:'white',padding:'10px',borderRadius:'5px'},children:SITE_TYPES.map(type=>/*#__PURE__*/_jsxs(\"label\",{style:{display:'block'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedTypes.includes(normalizeType(type)),onChange:()=>handleTypeToggle(normalizeType(type))}),type]},type))}),/*#__PURE__*/_jsx(SiteLayer,{sites:sites,visibleTypes:selectedTypes,maxMarkers:500})]});};// Fonction pour obtenir la classe d'ic�ne FontAwesome en fonction du type\nconst getIconClassForType=iconType=>{switch(iconType){case'droplet':return'fa-tint';case'circle':return'fa-circle';case'square':return'fa-square';case'triangle':return'fa-exclamation-triangle';case'star':return'fa-star';case'pin':return'fa-map-marker-alt';default:return'fa-tint';}};// Extension du prototype de Marker pour ajouter slideTo\nL.Marker.prototype.slideTo=function(latlng){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const duration=options.duration||1000;const keepAtCenter=options.keepAtCenter||false;const start=this.getLatLng();const startTime=performance.now();const animate=currentTime=>{const elapsed=currentTime-startTime;const progress=Math.min(elapsed/duration,1);const lat=start.lat+(latlng.lat-start.lat)*progress;const lng=start.lng+(latlng.lng-start.lng)*progress;this.setLatLng([lat,lng]);if(keepAtCenter){var _this$_map;(_this$_map=this._map)===null||_this$_map===void 0?void 0:_this$_map.setView([lat,lng]);}if(progress<1){requestAnimationFrame(animate);}};requestAnimationFrame(animate);};export default MapView;","map":{"version":3,"names":["React","useState","useEffect","useRef","useMemo","db","collection","getDocs","onSnapshot","MapContainer","TileLayer","Marker","Popup","LayerGroup","useMap","L","markerIcon2x","markerIcon","markerShadow","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Icon","Default","prototype","_getIconUrl","mergeOptions","iconUrl","iconRetinaUrl","shadowUrl","iconSize","iconAnchor","popupAnchor","shadowSize","siteIcon","icon","departIcon","arrivalIcon","laboratoireIcon","className","cliniqueIcon","plateauIcon","collecteIcon","etablissementIcon","ehpadIcon","veterinaireIcon","SITE_TYPES","POLES","normalizeType","type","normalized","toLowerCase","trim","typeMap","key","value","Object","entries","includes","getDefaultIconForSiteType","normalizedType","FullscreenControl","map","isFullscreen","setIsFullscreen","Control","extend","options","position","onAdd","container","DomUtil","create","button","innerHTML","href","title","setAttribute","DomEvent","on","e","preventDefault","mapContainer","getContainer","document","fullscreenElement","requestFullscreen","exitFullscreen","handleFullscreenChange","addEventListener","fullscreenControl","addControl","removeControl","removeEventListener","AllSitesLayer","_ref","sites","getIconForSiteType","showLabels","showGeneratedCoordinates","layerRef","isVisible","setIsVisible","current","layerGroup","addTo","clearLayers","hasLayer","addLayer","removeLayer","forEach","site","isGeneratedCoords","hasOwnProperty","isGeneratedCoordinates","latitude","longitude","_layerRef$current","marker","bindPopup","nom","adresse","pole","bindTooltip","permanent","direction","handleLayerControlChange","layersControl","querySelector","checkboxes","querySelectorAll","checkbox","_nextSibling","_nextSibling$textCont","nextSibling","textContent","checked","isChecked","target","checkLayersControl","setTimeout","_nextSibling2","_nextSibling2$textCon","SiteTypeLayer","_ref2","filteredSites","filter","_layerRef$current2","_nextSibling3","_nextSibling3$textCon","_nextSibling4","_nextSibling4$textCon","PoleLayer","_ref3","_layerRef$current3","_nextSibling5","_nextSibling5$textCon","_nextSibling6","_nextSibling6$textCon","CouriersLayer","_ref4","courierLocations","formatDate","courier","_layerRef$current4","isArrival","tourneeName","lastScan","siteName","_nextSibling7","_nextSibling7$textCon","_nextSibling8","_nextSibling8$textCon","AnimatedMarker","_ref5","popup","markerId","markerRef","currentPos","getLatLng","targetPos","latLng","equals","slideTo","duration","keepAtCenter","ref","children","franceCenter","generateCoordinates","index","baseLatitude","baseLongitude","codePostal","length","departement","parseInt","substring","latOffset","lonOffset","Math","floor","siteOffset","ville","firstLetter","charAt","toUpperCase","letterCode","charCodeAt","SiteLegend","markerPreferences","setMarkerPreferences","legendControlRef","updateTimerRef","legendContent","legendItems","pref","color","name","join","fetchPreferences","preferencesRef","snapshot","empty","preferencesData","docs","doc","id","data","console","debug","error","LegendControl","div","updateLegendContent","_container","legendContainer","unsubscribe","clearTimeout","window","import","meta","env","DEV","SectionHeader","_ref6","addCustomStyle","labels","label","span","classList","add","disabled","style","display","observer","MutationObserver","observe","childList","subtree","disconnect","MapControls","_ref7","setShowLabels","setSiteFilter","currentFilter","setShowGeneratedCoordinates","onZoomToSite","searchTerm","setSearchTerm","filtersVisible","setFiltersVisible","searchResults","setSearchResults","normalizedSearch","results","_site$nom","_site$adresse","_site$ville","_site$codePostal","_site$type","slice","MapControlsControl","labelsButton","toggle","filtersContainer","filterTitle","searchContainer","searchInput","placeholder","searchResultsContainer","updateSearchResults","resultItem","generatedCoordsContainer","generatedCoordsCheckbox","generatedCoordsLabel","htmlFor","filtersButton","disableClickPropagation","disableScrollPropagation","mapControlsControl","LayersEventInitializer","initLayersControl","event","Event","bubbles","dispatchEvent","overlaysContainer","_label$textContent","text","startsWith","_label$parentNode","separator","createElement","replace","parentNode","replaceChild","ManualCoordinatesCorrection","_ref8","onCoordinatesUpdated","isActive","setIsActive","selectedSite","setSelectedSite","_site$nom2","_site$adresse2","_site$ville2","_site$codePostal2","selectSite","setView","draggable","divIcon","html","openPopup","newLatLng","log","lat","lng","alert","saveCoordinates","cancelCorrection","CorrectionControl","correctionPanel","resultsContainer","selectedContainer","siteInfo","instructions","buttonsContainer","saveButton","cancelButton","closeButton","correctionControl","MemoizedMarker","memo","_ref9","normalizedSiteType","preference","find","siteType","getIconClassForType","prevProps","nextProps","JSON","stringify","SiteLayer","_ref10","visibleTypes","maxMarkers","currentZoom","setCurrentZoom","visibleSites","setVisibleSites","updateZoom","getZoom","off","isTypeVisible","some","selectedType","sitesToShow","coordinates","coords","undefined","isNaN","bounds","latLngBounds","fitBounds","padding","maxZoom","renderMarkers","clusterThreshold","clusterRadius","clusters","clustered","clusterKey","clusterLat","clusterLng","split","Number","distance","sqrt","pow","push","newClusterKey","toFixed","flatMap","_ref11","clusterSites","validSites","centerLat","reduce","sum","centerLng","clusterPreference","point","MapView","setSites","selectedTypes","setSelectedTypes","mapRef","loadData","sitesCollection","sitesSnapshot","loadedSites","preferencesSnapshot","handleTypeToggle","prev","t","center","zoom","height","width","url","attribution","bottom","right","zIndex","background","borderRadius","boxShadow","margin","textAlign","alignItems","marginBottom","marginRight","backgroundColor","justifyContent","fontSize","top","onChange","iconType","latlng","arguments","start","startTime","performance","now","animate","currentTime","elapsed","progress","min","setLatLng","_this$_map","_map","requestAnimationFrame"],"sources":["C:/Users/LS_110/Documents/GitHub/inovie-SCAN-web-main/src/components/MapView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback, useMemo } from 'react';\nimport { db } from '../config/firebase';\nimport { collection, query, where, getDocs, onSnapshot, Timestamp, updateDoc, doc, getDoc } from \n'firebase/firestore';\nimport { MapContainer, TileLayer, Marker, Popup, LayerGroup, LayersControl, useMap } from 'react-leaflet';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { geocodeAddress } from '../utils/geocoding';\nimport './MapView.css';\nimport 'leaflet.markercluster';\nimport './MarkerCluster.css';\nimport './MarkerCluster.Default.css';\nimport { MarkerPreference } from '../types';\n// Renommer les imports pour éviter les conflits avec les interfaces locales\n// import { Site, Tournee, MarkerPreference } from '../types';\n\n// Fix pour les icônes Leaflet\nimport markerIcon2x from 'leaflet/dist/images/marker-icon-2x.png';\nimport markerIcon from 'leaflet/dist/images/marker-icon.png';\nimport markerShadow from 'leaflet/dist/images/marker-shadow.png';\n\n// Correction pour les icônes Leaflet\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\n// Définir des icônes spécifiques\nconst siteIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\nconst departIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\nconst arrivalIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\n// Définir des icônes spécifiques pour chaque type de site\nconst laboratoireIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-laboratoire'\n});\n\nconst cliniqueIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-clinique'\n});\n\nconst plateauIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-plateau'\n});\n\nconst collecteIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-collecte'\n});\n\nconst etablissementIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-etablissement'\n});\n\nconst ehpadIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-ehpad'\n});\n\nconst veterinaireIcon = L.icon({\n  iconUrl: markerIcon,\n  iconRetinaUrl: markerIcon2x,\n  shadowUrl: markerShadow,\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41],\n  className: 'site-icon site-icon-veterinaire'\n});\n\n// Types de sites disponibles\nconst SITE_TYPES = [\n  'Laboratoire',\n  'Clinique',\n  'Plateau technique',\n  'Point de collecte',\n  'Etablissement de sant�',\n  'Ehpad',\n  'V�t�rinaire'\n];\n\n// P�les disponibles\nconst POLES = [\n  'Nord',\n  'Sud',\n  'Est',\n  'Ouest',\n  'Centre'\n];\n\n// Fonction pour normaliser les types de sites\nconst normalizeType = (type: string | undefined): string => {\n  if (!type) return '';\n  \n  const normalized = type.toLowerCase().trim();\n  \n  // Normaliser les types courants avec des correspondances plus pr�cises\n  const typeMap: { [key: string]: string } = {\n    'labo': 'laboratoire',\n    'laboratoire': 'laboratoire',\n    'plateau': 'plateau technique',\n    'plateau technique': 'plateau technique',\n    'clinique': 'clinique',\n    'collect': 'point de collecte',\n    'point de collecte': 'point de collecte',\n    'etablissement': 'etablissement de sant�',\n    '�tablissement': 'etablissement de sant�',\n    'etablissement de sant�': 'etablissement de sant�',\n    '�tablissement de sant�': 'etablissement de sant�',\n    'ehpad': 'ehpad',\n    'veterinaire': 'veterinaire',\n    'v�t�rinaire': 'veterinaire'\n  };\n  \n  // Recherche de correspondance exacte ou partielle\n  for (const [key, value] of Object.entries(typeMap)) {\n    if (normalized === key || normalized.includes(key)) {\n      return value;\n    }\n  }\n  \n  return normalized;\n};\n\n// Fonction pour obtenir l'ic�ne par d�faut en fonction du type de site\nconst getDefaultIconForSiteType = (type: string | undefined): L.Icon => {\n  if (!type) return siteIcon;\n  \n  // Normaliser le type pour la comparaison\n  const normalizedType = normalizeType(type);\n  \n  // Retourner l'ic�ne correspondante\n  if (normalizedType === 'laboratoire') {\n    return laboratoireIcon;\n  } else if (normalizedType === 'clinique') {\n    return cliniqueIcon;\n  } else if (normalizedType === 'plateau technique') {\n    return plateauIcon;\n  } else if (normalizedType === 'point de collecte') {\n    return collecteIcon;\n  } else if (normalizedType === 'etablissement de sant�') {\n    return etablissementIcon;\n  } else if (normalizedType === 'ehpad') {\n    return ehpadIcon;\n  } else if (normalizedType === 'veterinaire') {\n    return veterinaireIcon;\n  }\n  \n  // Par d�faut, retourner l'ic�ne g�n�rique\n  return siteIcon;\n};\n\ninterface CourierLocation {\n  id: string;\n  nom: string;\n  tourneeId: string;\n  tourneeName: string;\n  siteId: string;\n  siteName: string;\n  latitude: number;\n  longitude: number;\n  lastScan: Timestamp;\n  isArrival: boolean; // Indique si le coursier est � l'arriv�e ou au d�part\n}\n\ninterface Site {\n  id: string;\n  nom: string;\n  adresse: string;\n  ville?: string;\n  codePostal?: string;\n  codeBarres: string;\n  latitude?: number;\n  longitude?: number;\n  type?: string;\n  pole?: string;\n}\n\ninterface Tournee {\n  id: string;\n  nom: string;\n}\n\n// Composant pour ajouter le contr�le plein �cran personnalis�\nconst FullscreenControl: React.FC = () => {\n  const map = useMap();\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  \n  useEffect(() => {\n    // Cr�er un contr�le personnalis�\n    const FullscreenControl = L.Control.extend({\n      options: {\n        position: 'topleft'\n      },\n      \n      onAdd: function() {\n        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control');\n        const button = L.DomUtil.create('a', 'leaflet-control-fullscreen', container);\n        \n        button.innerHTML = '<i class=\"fas fa-expand\"></i>'; // Utiliser une ic�ne FontAwesome\n        button.href = '#';\n        button.title = 'Afficher en plein �cran';\n        button.setAttribute('role', 'button');\n        button.setAttribute('aria-label', 'Afficher en plein �cran');\n        \n        L.DomEvent.on(button, 'click', function(e) {\n          L.DomEvent.preventDefault(e);\n          \n          const mapContainer = map.getContainer();\n          \n          if (!document.fullscreenElement) {\n            if (mapContainer.requestFullscreen) {\n              mapContainer.requestFullscreen();\n              button.innerHTML = '<i class=\"fas fa-compress\"></i>'; // Ic�ne de r�duction\n              button.title = 'Quitter le plein �cran';\n              setIsFullscreen(true);\n            }\n          } else {\n            if (document.exitFullscreen) {\n              document.exitFullscreen();\n              button.innerHTML = '<i class=\"fas fa-expand\"></i>'; // Ic�ne d'agrandissement\n              button.title = 'Afficher en plein �cran';\n              setIsFullscreen(false);\n            }\n          }\n        });\n        \n        // �couter les changements d'�tat du plein �cran\n        const handleFullscreenChange = () => {\n          if (!document.fullscreenElement && isFullscreen) {\n            button.innerHTML = '<i class=\"fas fa-expand\"></i>';\n            button.title = 'Afficher en plein �cran';\n            setIsFullscreen(false);\n          }\n        };\n        \n        document.addEventListener('fullscreenchange', handleFullscreenChange);\n        \n        return container;\n      }\n    });\n    \n    // Ajouter le contr�le � la carte\n    const fullscreenControl = new FullscreenControl();\n    map.addControl(fullscreenControl);\n    \n    return () => {\n      map.removeControl(fullscreenControl);\n      document.removeEventListener('fullscreenchange', () => {});\n    };\n  }, [map, isFullscreen]);\n  \n  return null;\n};\n\n// Composant pour afficher tous les sites\nconst AllSitesLayer: React.FC<{\n  sites: Site[];\n  icon: L.Icon;\n  getIconForSiteType: (type: string) => L.Icon;\n  showLabels: boolean;\n  showGeneratedCoordinates: boolean;\n}> = ({ sites, icon, getIconForSiteType, showLabels, showGeneratedCoordinates }) => {\n  const map = useMap();\n  const layerRef = useRef<L.LayerGroup | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  useEffect(() => {\n    // Cr�er un nouveau LayerGroup si n�cessaire\n    if (!layerRef.current) {\n      layerRef.current = L.layerGroup();\n      \n      // Ajouter le LayerGroup �  la carte si la couche est visible\n      if (isVisible) {\n        layerRef.current.addTo(map);\n      }\n    } else {\n      // Sinon, vider le LayerGroup existant\n      layerRef.current.clearLayers();\n      \n      // Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\n      if (isVisible && !map.hasLayer(layerRef.current)) {\n        map.addLayer(layerRef.current);\n      } else if (!isVisible && map.hasLayer(layerRef.current)) {\n        map.removeLayer(layerRef.current);\n      }\n    }\n    \n    // Ajouter les marqueurs au LayerGroup seulement si la couche est visible\n    if (isVisible) {\n      sites.forEach(site => {\n        // V�rifier si les coordonn�es sont g�n�r�es\n        const isGeneratedCoords = site.hasOwnProperty('isGeneratedCoordinates') && \n                                (site as any).isGeneratedCoordinates === true;\n        \n        if (!showGeneratedCoordinates && isGeneratedCoords) {\n          return;\n        }\n        \n        if (site.latitude && site.longitude) {\n          const siteIcon = getIconForSiteType(site.type || '');\n          const marker = L.marker([site.latitude, site.longitude], { icon: siteIcon })\n            .bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole || 'Non d�fini'}</p>\n                ${isGeneratedCoords ? '<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>' : \n''}\n              </div>\n            `);\n          \n          if (showLabels) {\n            marker.bindTooltip(site.nom, { permanent: true, direction: 'top', className: 'site-label' });\n          }\n          \n          layerRef.current?.addLayer(marker);\n        }\n      });\n    }\n    \n    // Nettoyer le LayerGroup lors du d�montage du composant\n    return () => {\n      if (layerRef.current) {\n        if (map.hasLayer(layerRef.current)) {\n          map.removeLayer(layerRef.current);\n        }\n        layerRef.current = null;\n      }\n    };\n  }, [sites, icon, getIconForSiteType, showLabels, showGeneratedCoordinates, map, isVisible]);\n  \n  // G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\n  useEffect(() => {\n    const handleLayerControlChange = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === 'Tous les sites') {\n            // Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\n            setIsVisible((checkbox as HTMLInputElement).checked);\n            \n            // Ajouter un �couteur d'�v�nements pour les changements futurs\n            (checkbox as HTMLInputElement).addEventListener('change', (e) => {\n              const isChecked = (e.target as HTMLInputElement).checked;\n              setIsVisible(isChecked);\n            });\n          }\n        });\n      }\n    };\n    \n    // Attendre que le contr�le des couches soit ajout�  la carte\n    const checkLayersControl = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        handleLayerControlChange();\n      } else {\n        // Si le contr�le n'est pas encore disponible, r�essayer plus tard\n        setTimeout(checkLayersControl, 100);\n      }\n    };\n    \n    checkLayersControl();\n    \n    // Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\n    return () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === 'Tous les sites') {\n            (checkbox as HTMLInputElement).removeEventListener('change', () => {});\n          }\n        });\n      }\n    };\n  }, [map]);\n  \n  return null;\n};\n\n// Composant pour afficher les sites par type\nconst SiteTypeLayer: React.FC<{\n  sites: Site[];\n  icon: L.Icon;\n  type: string;\n  getIconForSiteType: (type: string) => L.Icon;\n  showLabels: boolean;\n  showGeneratedCoordinates: boolean;\n}> = ({ sites, icon, type, getIconForSiteType, showLabels, showGeneratedCoordinates }) => {\n  const map = useMap();\n  const layerRef = useRef<L.LayerGroup | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  useEffect(() => {\n    // Cr�er un nouveau LayerGroup si n�cessaire\n    if (!layerRef.current) {\n      layerRef.current = L.layerGroup();\n      \n      // Ajouter le LayerGroup �  la carte si la couche est visible\n      if (isVisible) {\n        layerRef.current.addTo(map);\n      }\n    } else {\n      // Sinon, vider le LayerGroup existant\n      layerRef.current.clearLayers();\n      \n      // Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\n      if (isVisible && !map.hasLayer(layerRef.current)) {\n        map.addLayer(layerRef.current);\n      } else if (!isVisible && map.hasLayer(layerRef.current)) {\n        map.removeLayer(layerRef.current);\n      }\n    }\n    \n    // Ajouter les marqueurs au LayerGroup seulement si la couche est visible\n    if (isVisible) {\n      // Filtrer les sites par type et ajouter les marqueurs au LayerGroup\n      const filteredSites = sites.filter(site => normalizeType(site.type || '') === normalizeType(type));\n      \n      filteredSites.forEach(site => {\n        // V�rifier si les coordonn�es sont g�n�r�es\n        const isGeneratedCoords = site.hasOwnProperty('isGeneratedCoordinates') && \n                                (site as any).isGeneratedCoordinates === true;\n        \n        if (!showGeneratedCoordinates && isGeneratedCoords) {\n          return;\n        }\n        \n        if (site.latitude && site.longitude) {\n          const siteIcon = getIconForSiteType(site.type || '');\n          const marker = L.marker([site.latitude, site.longitude], { icon: siteIcon })\n            .bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole || 'Non d�fini'}</p>\n                ${isGeneratedCoords ? '<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>' : \n''}\n              </div>\n            `);\n          \n          if (showLabels) {\n            marker.bindTooltip(site.nom, { permanent: true, direction: 'top', className: 'site-label' });\n          }\n          \n          layerRef.current?.addLayer(marker);\n        }\n      });\n    }\n    \n    // Nettoyer le LayerGroup lors du d�montage du composant\n    return () => {\n      if (layerRef.current) {\n        if (map.hasLayer(layerRef.current)) {\n          map.removeLayer(layerRef.current);\n        }\n        layerRef.current = null;\n      }\n    };\n  }, [sites, icon, type, getIconForSiteType, showLabels, showGeneratedCoordinates, map, isVisible]);\n  \n  // G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\n  useEffect(() => {\n    const handleLayerControlChange = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === type) {\n            // Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\n            setIsVisible((checkbox as HTMLInputElement).checked);\n            \n            // Ajouter un �couteur d'�v�nements pour les changements futurs\n            (checkbox as HTMLInputElement).addEventListener('change', (e) => {\n              const isChecked = (e.target as HTMLInputElement).checked;\n              setIsVisible(isChecked);\n            });\n          }\n        });\n      }\n    };\n    \n    // Attendre que le contr�le des couches soit ajout�  la carte\n    const checkLayersControl = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        handleLayerControlChange();\n      } else {\n        // Si le contr�le n'est pas encore disponible, r�essayer plus tard\n        setTimeout(checkLayersControl, 100);\n      }\n    };\n    \n    checkLayersControl();\n    \n    // Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\n    return () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === type) {\n            (checkbox as HTMLInputElement).removeEventListener('change', () => {});\n          }\n        });\n      }\n    };\n  }, [map, type]);\n  \n  return null;\n};\n\n// Composant pour afficher les sites par p�le\nconst PoleLayer: React.FC<{\n  sites: Site[];\n  icon: L.Icon;\n  pole: string;\n  getIconForSiteType: (type: string) => L.Icon;\n  showLabels: boolean;\n  showGeneratedCoordinates: boolean;\n}> = ({ sites, icon, pole, getIconForSiteType, showLabels, showGeneratedCoordinates }) => {\n  const map = useMap();\n  const layerRef = useRef<L.LayerGroup | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  useEffect(() => {\n    // Cr�er un nouveau LayerGroup si n�cessaire\n    if (!layerRef.current) {\n      layerRef.current = L.layerGroup();\n      \n      // Ajouter le LayerGroup �  la carte si la couche est visible\n      if (isVisible) {\n        layerRef.current.addTo(map);\n      }\n    } else {\n      // Sinon, vider le LayerGroup existant\n      layerRef.current.clearLayers();\n      \n      // Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\n      if (isVisible && !map.hasLayer(layerRef.current)) {\n        map.addLayer(layerRef.current);\n      } else if (!isVisible && map.hasLayer(layerRef.current)) {\n        map.removeLayer(layerRef.current);\n      }\n    }\n    \n    // Ajouter les marqueurs au LayerGroup seulement si la couche est visible\n    if (isVisible) {\n      // Filtrer les sites par p�le et ajouter les marqueurs au LayerGroup\n      const filteredSites = sites.filter(site => site.pole === pole);\n      \n      filteredSites.forEach(site => {\n        // V�rifier si les coordonn�es sont g�n�r�es\n        const isGeneratedCoords = site.hasOwnProperty('isGeneratedCoordinates') && \n                                (site as any).isGeneratedCoordinates === true;\n        \n        if (!showGeneratedCoordinates && isGeneratedCoords) {\n          return;\n        }\n        \n        if (site.latitude && site.longitude) {\n          const siteIcon = getIconForSiteType(site.type || '');\n          const marker = L.marker([site.latitude, site.longitude], { icon: siteIcon })\n            .bindPopup(`\n              <div class=\"site-popup\">\n                <h3>${site.nom}</h3>\n                <p><strong>Type:</strong> ${site.type}</p>\n                <p><strong>Adresse:</strong> ${site.adresse}</p>\n                <p><strong>P�le:</strong> ${site.pole || 'Non d�fini'}</p>\n                ${isGeneratedCoords ? '<p class=\"warning\">Coordonn�es g�n�r�es automatiquement</p>' : \n''}\n              </div>\n            `);\n          \n          if (showLabels) {\n            marker.bindTooltip(site.nom, { permanent: true, direction: 'top', className: 'site-label' });\n          }\n          \n          layerRef.current?.addLayer(marker);\n        }\n      });\n    }\n    \n    // Nettoyer le LayerGroup lors du d�montage du composant\n    return () => {\n      if (layerRef.current) {\n        if (map.hasLayer(layerRef.current)) {\n          map.removeLayer(layerRef.current);\n        }\n        layerRef.current = null;\n      }\n    };\n  }, [sites, icon, pole, getIconForSiteType, showLabels, showGeneratedCoordinates, map, isVisible]);\n  \n  // G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\n  useEffect(() => {\n    const handleLayerControlChange = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === `P�le ${pole}`) {\n            // Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\n            setIsVisible((checkbox as HTMLInputElement).checked);\n            \n            // Ajouter un �couteur d'�v�nements pour les changements futurs\n            (checkbox as HTMLInputElement).addEventListener('change', (e) => {\n              const isChecked = (e.target as HTMLInputElement).checked;\n              setIsVisible(isChecked);\n            });\n          }\n        });\n      }\n    };\n    \n    // Attendre que le contr�le des couches soit ajout�  la carte\n    const checkLayersControl = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        handleLayerControlChange();\n      } else {\n        // Si le contr�le n'est pas encore disponible, r�essayer plus tard\n        setTimeout(checkLayersControl, 100);\n      }\n    };\n    \n    checkLayersControl();\n    \n    // Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\n    return () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === `P�le ${pole}`) {\n            (checkbox as HTMLInputElement).removeEventListener('change', () => {});\n          }\n        });\n      }\n    };\n  }, [map, pole]);\n  \n  return null;\n};\n\n// Composant pour afficher les coursiers\nconst CouriersLayer: React.FC<{\n  courierLocations: CourierLocation[];\n  departIcon: L.Icon;\n  arrivalIcon: L.Icon;\n  formatDate: (date: any) => string;\n}> = ({ courierLocations, departIcon, arrivalIcon, formatDate }) => {\n  const map = useMap();\n  const layerRef = useRef<L.LayerGroup | null>(null);\n  const [isVisible, setIsVisible] = useState(true);\n  \n  useEffect(() => {\n    // Cr�er un nouveau LayerGroup si n�cessaire\n    if (!layerRef.current) {\n      layerRef.current = L.layerGroup();\n      \n      // Ajouter le LayerGroup �  la carte si la couche est visible\n      if (isVisible) {\n        layerRef.current.addTo(map);\n      }\n    } else {\n      // Sinon, vider le LayerGroup existant\n      layerRef.current.clearLayers();\n      \n      // Ajouter ou retirer le LayerGroup de la carte selon la visibilit�\n      if (isVisible && !map.hasLayer(layerRef.current)) {\n        map.addLayer(layerRef.current);\n      } else if (!isVisible && map.hasLayer(layerRef.current)) {\n        map.removeLayer(layerRef.current);\n      }\n    }\n    \n    // Ajouter les marqueurs des coursiers au LayerGroup seulement si la couche est visible\n    if (isVisible) {\n      courierLocations.forEach(courier => {\n        const icon = courier.isArrival ? arrivalIcon : departIcon;\n        const marker = L.marker([courier.latitude, courier.longitude], { icon })\n          .bindPopup(`\n            <div class=\"courier-popup\">\n              <h3>${courier.nom}</h3>\n              <p><strong>Tourn�e:</strong> ${courier.tourneeName}</p>\n              <p><strong>Dernier scan:</strong> ${formatDate(courier.lastScan)}</p>\n              <p><strong>Site:</strong> ${courier.siteName}</p>\n              <p><strong>Statut:</strong> ${courier.isArrival ? 'Arriv�e' : 'D�part'}</p>\n            </div>\n          `);\n        \n        layerRef.current?.addLayer(marker);\n      });\n    }\n    \n    // Nettoyer le LayerGroup lors du d�montage du composant\n    return () => {\n      if (layerRef.current) {\n        if (map.hasLayer(layerRef.current)) {\n          map.removeLayer(layerRef.current);\n        }\n        layerRef.current = null;\n      }\n    };\n  }, [courierLocations, departIcon, arrivalIcon, formatDate, map, isVisible]);\n  \n  // G�rer l'affichage/masquage de la couche en fonction du contr�le des couches\n  useEffect(() => {\n    const handleLayerControlChange = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === 'Coursiers') {\n            // Mettre �  jour l'�tat de visibilit� en fonction de la case �  cocher\n            setIsVisible((checkbox as HTMLInputElement).checked);\n            \n            // Ajouter un �couteur d'�v�nements pour les changements futurs\n            (checkbox as HTMLInputElement).addEventListener('change', (e) => {\n              const isChecked = (e.target as HTMLInputElement).checked;\n              setIsVisible(isChecked);\n            });\n          }\n        });\n      }\n    };\n    \n    // Attendre que le contr�le des couches soit ajout�  la carte\n    const checkLayersControl = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        handleLayerControlChange();\n      } else {\n        // Si le contr�le n'est pas encore disponible, r�essayer plus tard\n        setTimeout(checkLayersControl, 100);\n      }\n    };\n    \n    checkLayersControl();\n    \n    // Nettoyer les �couteurs d'�v�nements lors du d�montage du composant\n    return () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          if ((checkbox as HTMLInputElement).nextSibling?.textContent?.trim() === 'Coursiers') {\n            (checkbox as HTMLInputElement).removeEventListener('change', () => {});\n          }\n        });\n      }\n    };\n  }, [map]);\n  \n  return null;\n};\n\n// Composant pour g�rer les animations des marqueurs\nconst AnimatedMarker: React.FC<{\n  position: [number, number];\n  icon: L.Icon;\n  popup: React.ReactNode;\n  markerId: string;\n}> = ({ position, icon, popup, markerId }) => {\n  const markerRef = useRef<L.Marker | null>(null);\n  const map = useMap();\n\n  useEffect(() => {\n    if (markerRef.current) {\n      const marker = markerRef.current;\n      const currentPos = marker.getLatLng();\n      const targetPos = L.latLng(position[0], position[1]);\n\n      // Animation fluide si le marqueur existe d�j� \n      if (currentPos && !currentPos.equals(targetPos)) {\n        marker.slideTo(targetPos, {\n          duration: 1000,\n          keepAtCenter: false\n        });\n      }\n    }\n  }, [position]);\n\n  return (\n    <Marker\n      position={position}\n      icon={icon}\n      ref={markerRef}\n    >\n      {popup}\n    </Marker>\n  );\n};\n\n// Coordonn�es du centre de la France\nconst franceCenter: [number, number] = [46.603354, 1.888334];\n\n// Fonction pour g�n�rer des coordonn�es pour un site sans coordonn�es\nconst generateCoordinates = (site: Site, index: number): [number, number] => {\n  // Coordonn�es de base (centre de la France)\n  const baseLatitude = 46.603354;\n  const baseLongitude = 1.888334;\n  \n  // Si le site a un code postal, utiliser les deux premiers chiffres pour g�n�rer des coordonn�es\n  if (site.codePostal && site.codePostal.length >= 2) {\n    const departement = parseInt(site.codePostal.substring(0, 2), 10);\n    \n    // Carte approximative des d�partements fran�ais (latitude et longitude)\n    // Nous utilisons le num�ro de d�partement pour g�n�rer des coordonn�es approximatives\n    const latOffset = ((departement % 10) - 5) * 0.5; // -2.5 �  +2.5 degr�s\n    const lonOffset = ((Math.floor(departement / 10) % 10) - 5) * 0.5; // -2.5 �  +2.5 degr�s\n    \n    // Ajouter un petit d�calage pour chaque site dans le m�me d�partement\n    const siteOffset = index * 0.01;\n    \n    return [\n      baseLatitude + latOffset + siteOffset,\n      baseLongitude + lonOffset + siteOffset\n    ];\n  }\n  \n  // Si le site a une ville mais pas de code postal, utiliser la premi�re lettre de la ville\n  if (site.ville) {\n    const firstLetter = site.ville.charAt(0).toUpperCase();\n    const letterCode = firstLetter.charCodeAt(0) - 65; // A=0, B=1, etc.\n    \n    // Utiliser le code de la lettre pour g�n�rer des coordonn�es\n    const latOffset = ((letterCode % 5) - 2) * 0.5; // -1 �  +1 degr�s\n    const lonOffset = ((Math.floor(letterCode / 5) % 5) - 2) * 0.5; // -1 �  +1 degr�s\n    \n    // Ajouter un petit d�calage pour chaque site dans la m�me ville\n    const siteOffset = index * 0.01;\n    \n    return [\n      baseLatitude + latOffset + siteOffset,\n      baseLongitude + lonOffset + siteOffset\n    ];\n  }\n  \n  // Si le site n'a ni code postal ni ville, utiliser un d�calage bas� sur l'index\n  return [\n    baseLatitude + (index * 0.01),\n    baseLongitude + (index * 0.01)\n  ];\n};\n\n// Composant pour la l�gende des sites\nconst SiteLegend: React.FC = () => {\n  const map = useMap();\n  const [markerPreferences, setMarkerPreferences] = useState<MarkerPreference[]>([]);\n  const legendControlRef = useRef<any>(null);\n  const updateTimerRef = useRef<number | null>(null);\n\n  // Utiliser useMemo pour �viter les recalculs inutiles du contenu de la l�gende\n  const legendContent = useMemo(() => {\n    // Utiliser les pr�f�rences de marqueurs si disponibles\n    const legendItems = markerPreferences.length > 0 \n      ? markerPreferences.map(pref => `\n          <div class=\"site-legend-item\">\n            <div class=\"site-legend-color\" style=\"background-color: ${pref.color};\"></div>\n            <div class=\"site-legend-label\">${pref.name}</div>\n          </div>\n        `).join('')\n      : `\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-laboratoire\"></div>\n          <div class=\"site-legend-label\">Laboratoire</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-clinique\"></div>\n          <div class=\"site-legend-label\">Clinique</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-plateau\"></div>\n          <div class=\"site-legend-label\">Plateau technique</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-collecte\"></div>\n          <div class=\"site-legend-label\">Point de collecte</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-etablissement\"></div>\n          <div class=\"site-legend-label\">�tablissement de sant�</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-ehpad\"></div>\n          <div class=\"site-legend-label\">Ehpad</div>\n        </div>\n        <div class=\"site-legend-item\">\n          <div class=\"site-legend-color site-legend-color-veterinaire\"></div>\n          <div class=\"site-legend-label\">V�t�rinaire</div>\n        </div>\n      `;\n    \n    return `\n      ${legendItems}\n      <div class=\"site-legend-item generated\">\n        <div class=\"site-legend-color\" style=\"border: 2px dashed red; opacity: 0.6;\"></div>\n        <div class=\"site-legend-label\">Coordonn�es g�n�r�es</div>\n      </div>\n    `;\n  }, [markerPreferences]);\n\n  useEffect(() => {\n    // R�cup�rer les pr�f�rences de marqueurs une seule fois\n    const fetchPreferences = async () => {\n      try {\n        const preferencesRef = collection(db, 'markerPreferences');\n        const snapshot = await getDocs(preferencesRef);\n        \n        if (!snapshot.empty) {\n          const preferencesData = snapshot.docs.map(doc => ({\n            id: doc.id,\n            ...doc.data()\n          })) as MarkerPreference[];\n          \n          setMarkerPreferences(preferencesData);\n          // Utiliser un niveau de log moins verbeux\n          console.debug(`L�gende: ${preferencesData.length} pr�f�rences de marqueurs charg�es`);\n        }\n      } catch (error) {\n        console.error('Erreur lors de la r�cup�ration des pr�f�rences de marqueurs pour la l�gende:', \nerror);\n      }\n    };\n    \n    fetchPreferences();\n    \n    // Cr�er un contr�le personnalis� pour la l�gende une seule fois\n    if (!legendControlRef.current) {\n      const LegendControl = L.Control.extend({\n        options: {\n          position: 'bottomright'\n        },\n        \n        onAdd: function(map: L.Map): HTMLElement {\n          const div = L.DomUtil.create('div', 'info legend site-legend');\n          div.innerHTML = `\n            <h4>Types de sites</h4>\n            <div class=\"site-legend-items\">Chargement...</div>\n          `;\n          return div;\n        }\n      });\n\n      // Ajouter le contr�le �  la carte une seule fois\n      legendControlRef.current = new LegendControl();\n      map.addControl(legendControlRef.current);\n    }\n\n    // Mettre �  jour le contenu de la l�gende\n    const updateLegendContent = () => {\n      if (!legendControlRef.current || !legendControlRef.current._container) return;\n      \n      const legendContainer = legendControlRef.current._container.querySelector('.site-legend-items');\n      if (!legendContainer) return;\n      \n      legendContainer.innerHTML = legendContent;\n    };\n    \n    // Mettre �  jour le contenu initial\n    updateLegendContent();\n    \n    // Configurer un �couteur pour les changements dans les pr�f�rences de marqueurs\n    // avec une fr�quence limit�e pour �viter les mises �  jour trop fr�quentes\n    const preferencesRef = collection(db, 'markerPreferences');\n    const unsubscribe = onSnapshot(preferencesRef, (snapshot) => {\n      // Annuler la mise �  jour pr�c�dente si elle est en attente\n      if (updateTimerRef.current !== null) {\n        clearTimeout(updateTimerRef.current);\n      }\n      \n      // Planifier une nouvelle mise �  jour avec un d�lai pour limiter la fr�quence\n      updateTimerRef.current = window.setTimeout(() => {\n        const preferencesData = snapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        })) as MarkerPreference[];\n        \n        setMarkerPreferences(preferencesData);\n        // Utiliser un niveau de log moins verbeux et limiter les informations affich�es\n        if (import.meta.env.DEV) {\n          console.debug(`Mise � jour de la l�gende: ${preferencesData.length} pr�f�rences`);\n        }\n        updateTimerRef.current = null;\n      }, 1000); // Attendre 1 seconde avant de mettre �  jour\n    });\n    \n    return () => {\n      unsubscribe();\n      if (updateTimerRef.current !== null) {\n        clearTimeout(updateTimerRef.current);\n      }\n    };\n  }, [map, legendContent]);\n\n  // Nettoyer le contr�le lors du d�montage final du composant\n  useEffect(() => {\n    return () => {\n      if (legendControlRef.current) {\n        map.removeControl(legendControlRef.current);\n        legendControlRef.current = null;\n      }\n    };\n  }, [map]);\n\n  return null;\n};\n\n// Composant pour les en-t�tes de section dans le contr�le des couches\nconst SectionHeader: React.FC<{ title: string }> = ({ title }) => {\n  const map = useMap();\n  \n  useEffect(() => {\n    // Ajouter un style personnalis� apr�s le rendu du composant\n    const addCustomStyle = () => {\n      const labels = document.querySelectorAll('.leaflet-control-layers-overlays label');\n      \n      labels.forEach(label => {\n        const span = label.querySelector('span');\n        if (span && span.textContent === title) {\n          label.classList.add('layer-section-header');\n          const checkbox = label.querySelector('input[type=\"checkbox\"]') as HTMLInputElement;\n          if (checkbox) {\n            checkbox.disabled = true;\n            checkbox.style.display = 'none';\n          }\n        }\n      });\n    };\n    \n    // Ex�cuter apr�s un court d�lai pour s'assurer que le DOM est mis �  jour\n    setTimeout(addCustomStyle, 100);\n    \n    // Observer les changements dans le contr�le de couches\n    const observer = new MutationObserver(addCustomStyle);\n    const layersControl = document.querySelector('.leaflet-control-layers');\n    \n    if (layersControl) {\n      observer.observe(layersControl, { childList: true, subtree: true });\n    }\n    \n    return () => {\n      observer.disconnect();\n    };\n  }, [title]);\n  \n  return <LayerGroup />;\n};\n\n// Composant pour ajouter le contr�le des libell�s et des filtres personnalis�s\nconst MapControls: React.FC<{\n  showLabels: boolean,\n  setShowLabels: (show: boolean) => void,\n  sites: Site[],\n  setSiteFilter: (filter: string | null) => void,\n  currentFilter: string | null,\n  showGeneratedCoordinates: boolean,\n  setShowGeneratedCoordinates: (show: boolean) => void,\n  onZoomToSite: (site: Site) => void\n}> = ({ \n  showLabels, \n  setShowLabels, \n  sites, \n  setSiteFilter, \n  currentFilter,\n  showGeneratedCoordinates,\n  setShowGeneratedCoordinates,\n  onZoomToSite\n}) => {\n  const map = useMap();\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filtersVisible, setFiltersVisible] = useState(false);\n  const [searchResults, setSearchResults] = useState<Site[]>([]);\n  \n  // Mettre �  jour les r�sultats de recherche lorsque le terme de recherche change\n  useEffect(() => {\n    if (!searchTerm) {\n      setSearchResults([]);\n      return;\n    }\n    \n    const normalizedSearch = searchTerm.toLowerCase();\n    const results = sites.filter(site => \n      site.nom?.toLowerCase().includes(normalizedSearch) ||\n      site.adresse?.toLowerCase().includes(normalizedSearch) ||\n      site.ville?.toLowerCase().includes(normalizedSearch) ||\n      site.codePostal?.includes(normalizedSearch) ||\n      site.type?.toLowerCase().includes(normalizedSearch)\n    ).slice(0, 5); // Limiter �  5 r�sultats\n    \n    setSearchResults(results);\n  }, [searchTerm, sites]);\n  \n  useEffect(() => {\n    // Cr�er un contr�le personnalis�\n    const MapControlsControl = L.Control.extend({\n      options: {\n        position: 'topleft'\n      },\n      \n      onAdd: function() {\n        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control map-custom-controls');\n        \n        // Bouton pour activer/d�sactiver les libell�s\n        const labelsButton = L.DomUtil.create('a', 'leaflet-control-labels', container);\n        labelsButton.innerHTML = '<i class=\"fas fa-tag\"></i>';\n        labelsButton.href = '#';\n        labelsButton.title = showLabels ? 'Masquer les libell�s' : 'Afficher les libell�s';\n        labelsButton.setAttribute('role', 'button');\n        labelsButton.setAttribute('aria-label', showLabels ? 'Masquer les libell�s' : 'Afficher les libell�s');\n        \n        if (showLabels) {\n          labelsButton.classList.add('active');\n        }\n        \n        L.DomEvent.on(labelsButton, 'click', function(e) {\n          L.DomEvent.preventDefault(e);\n          setShowLabels(!showLabels);\n          labelsButton.title = !showLabels ? 'Masquer les libell�s' : 'Afficher les libell�s';\n          labelsButton.classList.toggle('active');\n        });\n        \n        // Cr�er un conteneur pour les filtres\n        const filtersContainer = L.DomUtil.create('div', 'map-filters-container', container);\n        filtersContainer.style.display = filtersVisible ? 'block' : 'none';\n        \n        // Ajouter un titre\n        const filterTitle = L.DomUtil.create('div', 'map-filter-title', filtersContainer);\n        filterTitle.textContent = 'Filtres';\n        \n        // Ajouter un champ de recherche\n        const searchContainer = L.DomUtil.create('div', 'map-filter-search', filtersContainer);\n        const searchInput = L.DomUtil.create('input', 'map-filter-search-input', searchContainer);\n        searchInput.type = 'text';\n        searchInput.placeholder = 'Rechercher un site...';\n        searchInput.value = searchTerm;\n        \n        // Conteneur pour les r�sultats de recherche\n        const searchResultsContainer = L.DomUtil.create('div', 'map-search-results', filtersContainer);\n        searchResultsContainer.style.display = 'none';\n        \n        // Mettre �  jour les r�sultats de recherche\n        const updateSearchResults = () => {\n          searchResultsContainer.innerHTML = '';\n          \n          if (searchResults.length === 0) {\n            if (searchTerm) {\n              searchResultsContainer.innerHTML = '<div class=\"map-search-no-results\">Aucun r�sultat trouv�</div>';\n              searchResultsContainer.style.display = 'block';\n            } else {\n              searchResultsContainer.style.display = 'none';\n            }\n            return;\n          }\n          \n          searchResultsContainer.style.display = 'block';\n          \n          searchResults.forEach(site => {\n            const resultItem = L.DomUtil.create('div', 'map-search-result-item', searchResultsContainer);\n            resultItem.innerHTML = `\n              <div class=\"map-search-result-name\">${site.nom}</div>\n              <div class=\"map-search-result-details\">\n                ${site.type ? `<span>${site.type}</span>` : ''}\n                ${site.ville ? `<span>${site.ville}</span>` : ''}\n              </div>\n            `;\n            \n            L.DomEvent.on(resultItem, 'click', function() {\n              onZoomToSite(site);\n              searchResultsContainer.style.display = 'none';\n              setSearchTerm('');\n              searchInput.value = '';\n            });\n          });\n        };\n        \n        // Mettre �  jour les r�sultats initiaux\n        updateSearchResults();\n        \n        // Mettre �  jour les r�sultats lorsqu'ils changent\n        const observer = new MutationObserver(() => {\n          updateSearchResults();\n        });\n        \n        L.DomEvent.on(searchInput, 'input', function(e) {\n          setSearchTerm((e.target as HTMLInputElement).value);\n          if ((e.target as HTMLInputElement).value) {\n            setSiteFilter((e.target as HTMLInputElement).value);\n          } else {\n            setSiteFilter(null);\n            searchResultsContainer.style.display = 'none';\n          }\n        });\n        \n        // Ajouter une option pour afficher/masquer les coordonn�es g�n�r�es\n        const generatedCoordsContainer = L.DomUtil.create('div', 'map-filter-option', filtersContainer);\n        const generatedCoordsCheckbox = L.DomUtil.create('input', '', generatedCoordsContainer);\n        generatedCoordsCheckbox.type = 'checkbox';\n        generatedCoordsCheckbox.id = 'show-generated-coords';\n        generatedCoordsCheckbox.checked = showGeneratedCoordinates;\n        \n        const generatedCoordsLabel = L.DomUtil.create('label', '', generatedCoordsContainer);\n        generatedCoordsLabel.htmlFor = 'show-generated-coords';\n        generatedCoordsLabel.textContent = 'Afficher les coordonn�es g�n�r�es';\n        \n        L.DomEvent.on(generatedCoordsCheckbox, 'change', function(e) {\n          setShowGeneratedCoordinates((e.target as HTMLInputElement).checked);\n        });\n        \n        // Bouton pour afficher/masquer les filtres\n        const filtersButton = L.DomUtil.create('a', 'leaflet-control-filters', container);\n        filtersButton.innerHTML = '<i class=\"fas fa-filter\"></i>';\n        filtersButton.href = '#';\n        filtersButton.title = 'Filtres avanc�s';\n        filtersButton.setAttribute('role', 'button');\n        filtersButton.setAttribute('aria-label', 'Filtres avanc�s');\n        \n        if (filtersVisible) {\n          filtersButton.classList.add('active');\n        }\n        \n        L.DomEvent.on(filtersButton, 'click', function(e) {\n          L.DomEvent.preventDefault(e);\n          setFiltersVisible(!filtersVisible);\n          filtersContainer.style.display = filtersVisible ? 'block' : 'none';\n          filtersButton.classList.toggle('active');\n        });\n        \n        // Emp�cher la propagation des �v�nements pour �viter que la carte ne se d�place\n        L.DomEvent.disableClickPropagation(container);\n        L.DomEvent.disableScrollPropagation(container);\n        \n        return container;\n      }\n    });\n    \n    // Ajouter le contr�le �  la carte\n    const mapControlsControl = new MapControlsControl();\n    map.addControl(mapControlsControl);\n    \n    return () => {\n      map.removeControl(mapControlsControl);\n    };\n  }, [map, showLabels, setShowLabels, sites, setSiteFilter, currentFilter, searchTerm, filtersVisible, \nshowGeneratedCoordinates, setShowGeneratedCoordinates, searchResults, onZoomToSite]);\n  \n  return null;\n};\n\n// Composant pour initialiser les �v�nements des couches\nconst LayersEventInitializer: React.FC = () => {\n  const map = useMap();\n  \n  useEffect(() => {\n    // Initialiser le contr�le des couches\n    const initLayersControl = () => {\n      const layersControl = document.querySelector('.leaflet-control-layers');\n      if (layersControl) {\n        // S'assurer que toutes les cases �  cocher sont coch�es par d�faut\n        const checkboxes = layersControl.querySelectorAll('input[type=\"checkbox\"]');\n        checkboxes.forEach(checkbox => {\n          (checkbox as HTMLInputElement).checked = true;\n        });\n        \n        // D�clencher un �v�nement change sur chaque case �  cocher pour activer les couches\n        checkboxes.forEach(checkbox => {\n          const event = new Event('change', { bubbles: true });\n          (checkbox as HTMLInputElement).dispatchEvent(event);\n        });\n        \n        // Ajouter des s�parateurs visuels pour les sections\n        const overlaysContainer = layersControl.querySelector('.leaflet-control-layers-overlays');\n        if (overlaysContainer) {\n          const labels = overlaysContainer.querySelectorAll('label');\n          labels.forEach(label => {\n            const text = label.textContent?.trim();\n            if (text && text.startsWith('---')) {\n              // Cr�er un �l�ment de s�paration\n              const separator = document.createElement('div');\n              separator.className = 'layer-section-header';\n              separator.innerHTML = `<span>${text.replace(/^---\\s*/, '')}</span>`;\n              \n              // Remplacer le label par le s�parateur\n              label.parentNode?.replaceChild(separator, label);\n            }\n          });\n        }\n      } else {\n        // Si le contr�le n'est pas encore disponible, r�essayer plus tard\n        setTimeout(initLayersControl, 100);\n      }\n    };\n    \n    // Attendre que la carte soit charg�e avant d'initialiser le contr�le des couches\n    setTimeout(initLayersControl, 500);\n    \n    return () => {\n      // Nettoyer les �couteurs d'�v�nements si n�cessaire\n    };\n  }, [map]);\n  \n  return null;\n};\n\n// Composant pour corriger manuellement les coordonn�es d'un site\nconst ManualCoordinatesCorrection: React.FC<{\n  sites: Site[];\n  onCoordinatesUpdated: (siteId: string, latitude: number, longitude: number) => void;\n}> = ({ sites, onCoordinatesUpdated }) => {\n  const map = useMap();\n  const [isActive, setIsActive] = useState(false);\n  const [selectedSite, setSelectedSite] = useState<Site | null>(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [searchResults, setSearchResults] = useState<Site[]>([]);\n  const markerRef = useRef<L.Marker | null>(null);\n  \n  // Filtrer les sites en fonction du terme de recherche\n  useEffect(() => {\n    if (!searchTerm) {\n      setSearchResults([]);\n      return;\n    }\n    \n    const normalizedSearch = searchTerm.toLowerCase();\n    const results = sites.filter(site => \n      site.nom?.toLowerCase().includes(normalizedSearch) ||\n      site.adresse?.toLowerCase().includes(normalizedSearch) ||\n      site.ville?.toLowerCase().includes(normalizedSearch) ||\n      site.codePostal?.includes(normalizedSearch)\n    ).slice(0, 10); // Limiter �  10 r�sultats\n    \n    setSearchResults(results);\n  }, [searchTerm, sites]);\n  \n  // Fonction pour s�lectionner un site\n  const selectSite = (site: Site) => {\n    setSelectedSite(site);\n    setSearchTerm('');\n    setSearchResults([]);\n    \n    if (site.latitude && site.longitude) {\n      // Centrer la carte sur le site\n      map.setView([site.latitude, site.longitude], 15);\n      \n      // Cr�er un marqueur d�pla�able\n      if (markerRef.current) {\n        map.removeLayer(markerRef.current);\n      }\n      \n      const marker = L.marker([site.latitude, site.longitude], {\n        draggable: true,\n        icon: L.divIcon({\n          className: 'correction-marker',\n          html: `<div style=\"background-color: red; width: 24px; height: 24px; border-radius: 50%; \ndisplay: flex; justify-content: center; align-items: center; box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);\">\n                  <i class=\"fas fa-map-marker-alt\" style=\"color: white; font-size: 14px;\"></i>\n                </div>`,\n          iconSize: [24, 24],\n          iconAnchor: [12, 12]\n        })\n      }).addTo(map);\n      \n      // Ajouter un popup avec les informations du site\n      marker.bindPopup(`\n        <div>\n          <strong>${site.nom}</strong><br>\n          ${site.adresse}<br>\n          ${site.codePostal} ${site.ville || ''}\n        </div>\n      `).openPopup();\n      \n      // Mettre �  jour les coordonn�es lorsque le marqueur est d�plac�\n      marker.on('dragend', (e) => {\n        const newLatLng = marker.getLatLng();\n        console.log(`Nouvelles coordonn�es pour ${site.nom}: Lat=${newLatLng.lat}, Lng=${newLatLng.lng}`);\n      });\n      \n      markerRef.current = marker;\n    } else {\n      alert(`Le site \"${site.nom}\" n'a pas de coordonn�es. Veuillez d'abord le g�ocoder.`);\n    }\n  };\n  \n  // Fonction pour enregistrer les nouvelles coordonn�es\n  const saveCoordinates = () => {\n    if (selectedSite && markerRef.current) {\n      const newLatLng = markerRef.current.getLatLng();\n      onCoordinatesUpdated(selectedSite.id, newLatLng.lat, newLatLng.lng);\n      \n      // Afficher un message de confirmation\n      alert(`Les coordonn�es du site \"${selectedSite.nom}\" ont ét� mises �  jour.`);\n      \n      // R�initialiser\n      map.removeLayer(markerRef.current);\n      markerRef.current = null;\n      setSelectedSite(null);\n      setIsActive(false);\n    }\n  };\n  \n  // Fonction pour annuler la correction\n  const cancelCorrection = () => {\n    if (markerRef.current) {\n      map.removeLayer(markerRef.current);\n      markerRef.current = null;\n    }\n    \n    setSelectedSite(null);\n    setIsActive(false);\n  };\n  \n  useEffect(() => {\n    // Cr�er un contr�le personnalis�\n    const CorrectionControl = L.Control.extend({\n      options: {\n        position: 'topleft'\n      },\n      \n      onAdd: function() {\n        const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control correction-control');\n        \n        \n        if (!isActive) {\n          // Bouton pour activer la correction\n          const button = L.DomUtil.create('a', 'correction-button', container);\n          button.innerHTML = '<i class=\"fas fa-map-marker-alt\"></i>';\n          button.href = '#';\n          button.title = 'Corriger les coordonn�es d\\'un site';\n          \n          L.DomEvent.on(button, 'click', function(e) {\n            L.DomEvent.preventDefault(e);\n            setIsActive(true);\n          });\n        } else {\n          // Interface de correction\n          const correctionPanel = L.DomUtil.create('div', 'correction-panel', container);\n          \n          // Titre\n          const title = L.DomUtil.create('div', 'correction-title', correctionPanel);\n          title.textContent = 'Correction de coordonn�es';\n          \n          // Champ de recherche\n          const searchContainer = L.DomUtil.create('div', 'correction-search', correctionPanel);\n          const searchInput = L.DomUtil.create('input', 'correction-search-input', searchContainer);\n          searchInput.type = 'text';\n          searchInput.placeholder = 'Rechercher un site...';\n          searchInput.value = searchTerm;\n          \n          L.DomEvent.on(searchInput, 'input', function(e) {\n            setSearchTerm((e.target as HTMLInputElement).value);\n          });\n          \n          // R�sultats de recherche\n          if (searchResults.length > 0) {\n            const resultsContainer = L.DomUtil.create('div', 'correction-results', correctionPanel);\n            \n            searchResults.forEach(site => {\n              const resultItem = L.DomUtil.create('div', 'correction-result-item', resultsContainer);\n              resultItem.textContent = site.nom;\n              \n              L.DomEvent.on(resultItem, 'click', function() {\n                selectSite(site);\n              });\n            });\n          }\n          \n          // Site s�lectionn�\n          if (selectedSite) {\n            const selectedContainer = L.DomUtil.create('div', 'correction-selected', correctionPanel);\n            \n            const siteInfo = L.DomUtil.create('div', 'correction-site-info', selectedContainer);\n            siteInfo.innerHTML = `\n              <strong>${selectedSite.nom}</strong><br>\n              ${selectedSite.adresse}<br>\n              ${selectedSite.codePostal} ${selectedSite.ville || ''}\n            `;\n            \n            const instructions = L.DomUtil.create('div', 'correction-instructions', selectedContainer);\n            instructions.textContent = 'D�placez le marqueur rouge � la position correcte, puis cliquez sur \"Enregistrer\".';\n            \n            const buttonsContainer = L.DomUtil.create('div', 'correction-buttons', selectedContainer);\n            \n            const saveButton = L.DomUtil.create('button', 'correction-save-button', buttonsContainer);\n            saveButton.textContent = 'Enregistrer';\n            \n            L.DomEvent.on(saveButton, 'click', function() {\n              saveCoordinates();\n            });\n            \n            const cancelButton = L.DomUtil.create('button', 'correction-cancel-button', buttonsContainer);\n            cancelButton.textContent = 'Annuler';\n            \n            L.DomEvent.on(cancelButton, 'click', function() {\n              cancelCorrection();\n            });\n          }\n          \n          // Bouton pour fermer le panneau\n          if (!selectedSite) {\n            const closeButton = L.DomUtil.create('button', 'correction-close-button', correctionPanel);\n            closeButton.textContent = 'Fermer';\n            \n            L.DomEvent.on(closeButton, 'click', function() {\n              setIsActive(false);\n            });\n          }\n        }\n        \n        // Emp�cher la propagation des �v�nements pour �viter que la carte ne se d�place\n        L.DomEvent.disableClickPropagation(container);\n        L.DomEvent.disableScrollPropagation(container);\n        \n        return container;\n      }\n    });\n    \n    // Ajouter le contr�le �  la carte\n    const correctionControl = new CorrectionControl();\n    map.addControl(correctionControl);\n    \n    return () => {\n      map.removeControl(correctionControl);\n      \n      if (markerRef.current) {\n        map.removeLayer(markerRef.current);\n        markerRef.current = null;\n      }\n    };\n  }, [map, isActive, searchTerm, searchResults, selectedSite, sites, onCoordinatesUpdated]);\n  \n  return null;\n};\n\n// Composant de marqueur m�mo�s�\nconst MemoizedMarker = React.memo<{ \n  site: Site, \n  markerPreferences: MarkerPreference[] \n}>(({ site, markerPreferences }) => {\n  // R�cup�rer l'ic�ne personnalis�e en fonction des pr�f�rences\n  const siteIcon = useMemo(() => {\n    const normalizedSiteType = normalizeType(site.type);\n    \n    const preference = markerPreferences.find(pref => \n      normalizeType(pref.siteType) === normalizedSiteType\n    );\n\n    if (preference) {\n      return L.divIcon({\n        className: 'custom-div-icon',\n        html: `\n          <div style=\"background-color: ${preference.color}; \n                      width: 24px; \n                      height: 24px; \n                      border-radius: 50%; \n                      display: flex; \n                      justify-content: center; \n                      align-items: center; \n                      box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);\">\n            <i class=\"fas ${getIconClassForType(preference.icon)}\" \n               style=\"color: white; font-size: 14px;\"></i>\n          </div>\n        `,\n        iconSize: [24, 24],\n        iconAnchor: [12, 12]\n      });\n    }\n\n    return getDefaultIconForSiteType(site.type);\n  }, [site.type, markerPreferences]);\n\n  if (!site.latitude || !site.longitude) return null;\n\n  return (\n    <Marker \n      key={site.id}\n      position={[site.latitude, site.longitude] as L.LatLngTuple}\n      icon={siteIcon}\n    >\n      <Popup>\n        <div>\n          <strong>{site.nom}</strong>\n          <br />\n          {site.adresse}\n          <br />\n          {site.ville} {site.codePostal}\n          <br />\n          Type: {site.type}\n        </div>\n      </Popup>\n    </Marker>\n  );\n}, (prevProps, nextProps) => {\n  // Comparaison personnalis�e pour �viter les re-rendus inutiles\n  return (\n    prevProps.site.id === nextProps.site.id &&\n    prevProps.site.latitude === nextProps.site.latitude &&\n    prevProps.site.longitude === nextProps.site.longitude &&\n    prevProps.site.type === nextProps.site.type &&\n    JSON.stringify(prevProps.markerPreferences) === JSON.stringify(nextProps.markerPreferences)\n  );\n});\n\n// Composant de clustering dynamique\nconst SiteLayer: React.FC<{ \n  sites: Site[], \n  visibleTypes?: string[], \n  maxMarkers?: number \n}> = ({ \n  sites, \n  visibleTypes = [], \n  maxMarkers = 500 \n}) => {\n  const map = useMap();\n  const [currentZoom, setCurrentZoom] = useState(8);\n  const [visibleSites, setVisibleSites] = useState<Site[]>([]);\n  const [markerPreferences, setMarkerPreferences] = useState<MarkerPreference[]>([]);\n\n  // Mettre � jour le zoom lors des changements de la carte\n  useEffect(() => {\n    if (!map) return;\n\n    const updateZoom = () => {\n      setCurrentZoom(map.getZoom());\n    };\n\n    map.on('zoomend', updateZoom);\n    return () => {\n      map.off('zoomend', updateZoom);\n    };\n  }, [map]);\n\n  // Charger les pr�f�rences de marqueurs\n  useEffect(() => {\n    const fetchPreferences = async () => {\n      try {\n        const preferencesRef = collection(db, 'markerPreferences');\n        const snapshot = await getDocs(preferencesRef);\n        \n        const preferencesData = snapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        })) as MarkerPreference[];\n        \n        setMarkerPreferences(preferencesData);\n      } catch (error) {\n        console.error('Erreur lors du chargement des pr�f�rences de marqueurs:', error);\n      }\n    };\n\n    fetchPreferences();\n  }, []);\n\n  // Filtrage et pagination des sites\n  const filteredSites = useMemo(() => {\n    return sites.filter(site => {\n      const normalizedSiteType = normalizeType(site.type);\n      \n      // Si aucun type n'est s�lectionn�, afficher tous les sites\n      if (visibleTypes.length === 0) {\n        return site.latitude && site.longitude;\n      }\n      \n      // V�rifier si le type de site est dans les types s�lectionn�s\n      const isTypeVisible = visibleTypes.some(selectedType => \n        normalizedSiteType === normalizeType(selectedType)\n      );\n      \n      return isTypeVisible && site.latitude && site.longitude;\n    });\n  }, [sites, visibleTypes]);\n\n  // Mettre � jour les sites visibles\n  useEffect(() => {\n    const sitesToShow = filteredSites.slice(0, maxMarkers);\n    setVisibleSites(sitesToShow);\n\n    // Ajuster la vue de la carte\n    if (map && sitesToShow.length > 0) {\n      const coordinates = sitesToShow\n        .map(site => [site.latitude, site.longitude])\n        .filter((coords): coords is [number, number] => \n          coords[0] !== undefined && \n          coords[1] !== undefined && \n          !isNaN(coords[0]) && \n          !isNaN(coords[1])\n        );\n      \n      if (coordinates.length > 0) {\n        const bounds = L.latLngBounds(coordinates);\n        map.fitBounds(bounds, { \n          padding: [50, 50],\n          maxZoom: 12\n        });\n      }\n    }\n  }, [filteredSites, map, maxMarkers]);\n\n  // Clustering personnalis�\n  const renderMarkers = useMemo(() => {\n    // Si le nombre de sites est faible, afficher tous les marqueurs\n    if (visibleSites.length <= 50) {\n      return visibleSites.map(site => (\n        <MemoizedMarker \n          key={site.id} \n          site={site} \n          markerPreferences={markerPreferences}\n        />\n      ));\n    }\n\n    // Clustering dynamique bas� sur le niveau de zoom\n    const currentZoom = map ? map.getZoom() : 8; // Zoom par d�faut\n    const clusterThreshold = 12; // Niveau de zoom o� le clustering commence � se d�sagr�ger\n    const clusterRadius = currentZoom < clusterThreshold \n      ? 0.2 // Rayon de clustering plus grand pour les zooms �loign�s\n      : 0.05; // Rayon plus petit pour un d�groupement plus pr�coce\n\n    const clusters: { [key: string]: Site[] } = {};\n\n    visibleSites.forEach(site => {\n      if (!site.latitude || !site.longitude) return;\n\n      let clustered = false;\n      for (const clusterKey in clusters) {\n        const [clusterLat, clusterLng] = clusterKey.split(',').map(Number);\n        const distance = Math.sqrt(\n          Math.pow(site.latitude - clusterLat, 2) + \n          Math.pow(site.longitude - clusterLng, 2)\n        );\n\n        // Ajuster la logique de clustering en fonction du zoom\n        if (distance < clusterRadius) {\n          clusters[clusterKey].push(site);\n          clustered = true;\n          break;\n        }\n      }\n\n      if (!clustered) {\n        const newClusterKey = `${site.latitude.toFixed(1)},${site.longitude.toFixed(1)}`;\n        clusters[newClusterKey] = [site];\n      }\n    });\n\n    // Rendu des clusters\n    return Object.entries(clusters).flatMap(([key, clusterSites]) => {\n      // D�grouper plus t�t si le zoom est suffisant\n      if (currentZoom >= clusterThreshold || clusterSites.length <= 3) {\n        return clusterSites.map(site => (\n          <MemoizedMarker \n            key={site.id} \n            site={site} \n            markerPreferences={markerPreferences}\n          />\n        ));\n      }\n\n      // Cluster avec plusieurs sites\n      const validSites = clusterSites.filter((site): site is Site => \n        site.latitude !== undefined && \n        site.longitude !== undefined\n      );\n\n      if (validSites.length === 0) return [];\n\n      const centerLat = validSites.reduce((sum, site) => sum + (site.latitude || 0), 0) / validSites.length;\n      const centerLng = validSites.reduce((sum, site) => sum + (site.longitude || 0), 0) / validSites.length;\n\n      // D�terminer l'ic�ne et la couleur du cluster\n      const clusterPreference = markerPreferences.find(pref => \n        normalizeType(pref.siteType) === \n        normalizeType(validSites[0].type)\n      );\n\n      return [\n        <Marker \n          key={`cluster-${key}`} \n          position={[centerLat, centerLng]}\n          icon={L.divIcon({\n            className: 'marker-cluster',\n            html: `\n              <div style=\"\n                background-color: ${clusterPreference?.color || 'gray'}; \n                width: 40px; \n                height: 40px; \n                border-radius: 50%; \n                display: flex; \n                justify-content: center; \n                align-items: center; \n                color: white; \n                font-weight: bold;\n                box-shadow: 0 0 5px rgba(0,0,0,0.3);\n                opacity: ${currentZoom < clusterThreshold ? 1 : 0.7};\n              \">\n                ${clusterSites.length}\n              </div>\n            `,\n            iconSize: L.point(40, 40)\n          })}\n        >\n          <Popup>\n            <div>\n              <strong>Cluster de {clusterSites.length} sites</strong>\n              <ul>\n                {clusterSites.slice(0, 5).map(site => (\n                  <li key={site.id}>{site.nom}</li>\n                ))}\n                {clusterSites.length > 5 && <li>... et {clusterSites.length - 5} autres</li>}\n              </ul>\n            </div>\n          </Popup>\n        </Marker>\n      ];\n    }); \n  }, [visibleSites, markerPreferences, map, currentZoom]);\n\n  return <>{renderMarkers}</>;\n};\n\nconst MapView: React.FC = () => {\n  const [sites, setSites] = useState<Site[]>([]);\n  const [selectedTypes, setSelectedTypes] = useState<string[]>([]);\n  const [markerPreferences, setMarkerPreferences] = useState<MarkerPreference[]>([]);\n  const mapRef = useRef<L.Map | null>(null);\n\n  // Charger les sites et les pr�f�rences de marqueurs\n  useEffect(() => {\n    const loadData = async () => {\n      try {\n        // Charger les sites\n        const sitesCollection = collection(db, 'sites');\n        const sitesSnapshot = await getDocs(sitesCollection);\n        const loadedSites = sitesSnapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        } as Site));\n\n        // Filtrer les sites avec coordonn�es\n        const validSites = loadedSites.filter(site => \n          site.latitude && site.longitude\n        );\n\n        setSites(validSites);\n\n        // Charger les pr�f�rences de marqueurs\n        const preferencesRef = collection(db, 'markerPreferences');\n        const preferencesSnapshot = await getDocs(preferencesRef);\n        const preferencesData = preferencesSnapshot.docs.map(doc => ({\n          id: doc.id,\n          ...doc.data()\n        })) as MarkerPreference[];\n\n        setMarkerPreferences(preferencesData);\n      } catch (error) {\n        console.error('Erreur lors du chargement des donn�es:', error);\n      }\n    };\n\n    loadData();\n  }, []);\n\n  // Gestion des types de sites s�lectionn�s\n  const handleTypeToggle = (type: string) => {\n    setSelectedTypes(prev => \n      prev.includes(type) \n        ? prev.filter(t => t !== type)\n        : [...prev, type]\n    );\n  };\n\n  return (\n    <MapContainer \n      center={[43.6, 3.8]} \n      zoom={8} \n      style={{ height: '100vh', width: '100%' }}\n      ref={(ref) => { mapRef.current = ref; }}\n    >\n      <TileLayer\n        url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n        attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n      />\n\n      {/* Contr�le plein �cran */}\n      <FullscreenControl />\n\n      {/* L�gende des sites */}\n      <div style={{ \n        position: 'absolute', \n        bottom: '20px', \n        right: '20px', \n        zIndex: 1000, \n        background: 'white', \n        padding: '10px', \n        borderRadius: '5px',\n        boxShadow: '0 2px 5px rgba(0,0,0,0.1)'\n      }}>\n        <h4 style={{ margin: '0 0 10px 0', textAlign: 'center' }}>Types de sites</h4>\n        {SITE_TYPES.map(type => {\n          const normalizedType = normalizeType(type);\n          const preference = markerPreferences.find(pref => \n            normalizeType(pref.siteType) === normalizedType\n          );\n\n          return (\n            <div \n              key={type} \n              style={{ \n                display: 'flex', \n                alignItems: 'center', \n                marginBottom: '5px' \n              }}\n            >\n              <div \n                style={{ \n                  width: '20px', \n                  height: '20px', \n                  borderRadius: '50%', \n                  marginRight: '10px',\n                  backgroundColor: preference ? preference.color : 'gray',\n                  display: 'flex',\n                  justifyContent: 'center',\n                  alignItems: 'center'\n                }}\n              >\n                {preference && (\n                  <i \n                    className={`fas ${getIconClassForType(preference.icon)}`} \n                    style={{ \n                      color: 'white', \n                      fontSize: '12px' \n                    }} \n                  />\n                )}\n              </div>\n              <span>{type}</span>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Contr�le de s�lection des types de sites */}\n      <div style={{ \n        position: 'absolute', \n        top: '10px', \n        right: '10px', \n        zIndex: 1000, \n        background: 'white', \n        padding: '10px', \n        borderRadius: '5px' \n      }}>\n        {SITE_TYPES.map(type => (\n          <label key={type} style={{ display: 'block' }}>\n            <input \n              type=\"checkbox\" \n              checked={selectedTypes.includes(normalizeType(type))}\n              onChange={() => handleTypeToggle(normalizeType(type))}\n            />\n            {type}\n          </label>\n        ))}\n      </div>\n\n      {/* Couche de sites avec optimisations */}\n      <SiteLayer \n        sites={sites} \n        visibleTypes={selectedTypes}\n        maxMarkers={500}\n      />\n    </MapContainer>\n  );\n};\n\n// Fonction pour obtenir la classe d'ic�ne FontAwesome en fonction du type\nconst getIconClassForType = (iconType: string): string => {\n  switch (iconType) {\n    case 'droplet':\n      return 'fa-tint';\n    case 'circle':\n      return 'fa-circle';\n    case 'square':\n      return 'fa-square';\n    case 'triangle':\n      return 'fa-exclamation-triangle';\n    case 'star':\n      return 'fa-star';\n    case 'pin':\n      return 'fa-map-marker-alt';\n    default:\n      return 'fa-tint';\n  }\n};\n\n// Extension du prototype de Marker pour ajouter slideTo\ndeclare module 'leaflet' {\n  interface Marker {\n    slideTo(latlng: L.LatLng, options?: { duration?: number; keepAtCenter?: boolean }): void;\n  }\n}\n\nL.Marker.prototype.slideTo = function(latlng: L.LatLng, options: { duration?: number; keepAtCenter?: boolean } = {}) {\n  const duration = options.duration || 1000;\n  const keepAtCenter = options.keepAtCenter || false;\n  \n  const start = this.getLatLng();\n  const startTime = performance.now();\n  \n  const animate = (currentTime: number) => {\n    const elapsed = currentTime - startTime;\n    const progress = Math.min(elapsed / duration, 1);\n    \n    const lat = start.lat + (latlng.lat - start.lat) * progress;\n    const lng = start.lng + (latlng.lng - start.lng) * progress;\n    \n    this.setLatLng([lat, lng]);\n    \n    if (keepAtCenter) {\n      this._map?.setView([lat, lng]);\n    }\n    \n    if (progress < 1) {\n      requestAnimationFrame(animate);\n    }\n  };\n  \n  requestAnimationFrame(animate);\n};\n\nexport default MapView; \n\n\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}