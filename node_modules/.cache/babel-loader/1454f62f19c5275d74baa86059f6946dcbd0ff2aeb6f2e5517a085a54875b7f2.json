{"ast":null,"code":"// @ts-nocheck\nimport React,{useState,useEffect}from'react';import{collection,getDocs,addDoc,updateDoc,deleteDoc,doc,Timestamp}from'firebase/firestore';import{db}from'../config/firebase';import DatePicker from'react-datepicker';import{registerLocale}from'react-datepicker';import{fr}from'date-fns/locale';import'react-datepicker/dist/react-datepicker.css';import'./EditMode.css';import'./Tournees.css';import{usePoles}from'../services/PoleService';import PoleSelector from'./PoleSelector';import PoleFilter from'./PoleFilter';// Enregistrer la locale française\nimport{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";registerLocale('fr',fr);const Tournees=()=>{const[tournees,setTournees]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// État pour le modal\nconst[isModalOpen,setIsModalOpen]=useState(false);const[isEditing,setIsEditing]=useState(false);const[currentTournee,setCurrentTournee]=useState({nom:'',heureDepart:'',heureFinPrevue:'',heureFinReelle:'',coursier:'',vehicules:[],nombreColis:0,statut:'en_attente'});// État pour le mode édition et la sélection multiple\nconst[editMode,setEditMode]=useState(false);const[selectedTournees,setSelectedTournees]=useState([]);const[editingTournees,setEditingTournees]=useState({});const[vehicules,setVehicules]=useState([]);const[sites,setSites]=useState([]);const[selectAll,setSelectAll]=useState(false);// Ajouter un nouvel état pour les nouvelles tournées temporaires\nconst[newTournees,setNewTournees]=useState([]);// État pour la recherche rapide\nconst[quickSearch,setQuickSearch]=useState('');const[filteredTournees,setFilteredTournees]=useState([]);// Ajout du filtre par pôle\nconst[selectedPole,setSelectedPole]=useState('');// Utilisation du hook usePoles\nconst{poles}=usePoles();// Fonction pour obtenir le nom du pôle\nconst getPoleNameById=poleId=>{if(!poleId)return'-';const pole=poles.find(p=>p.id===poleId);return pole?pole.nom:poleId;};useEffect(()=>{fetchTournees();fetchVehicules();fetchSites();},[]);// Initialiser les tournées filtrées au chargement\nuseEffect(()=>{setFilteredTournees(tournees);},[tournees]);// Effet pour filtrer les tournées en fonction de la recherche rapide et du pôle sélectionné\nuseEffect(()=>{let results=tournees;// Filtrer par pôle si un pôle est sélectionné\nif(selectedPole){results=results.filter(tournee=>tournee.pole===selectedPole);}// Ensuite filtrer par recherche rapide\nif(quickSearch.trim()){const searchTerm=quickSearch.toLowerCase().trim();results=results.filter(tournee=>{// Rechercher dans tous les champs textuels de la tournée\nreturn tournee.nom.toLowerCase().includes(searchTerm)||tournee.heureDepart.toLowerCase().includes(searchTerm)||(tournee.heureFinReelle||'').toLowerCase().includes(searchTerm)||tournee.statut.toLowerCase().includes(searchTerm)||tournee.vehicules.some(vehiculeId=>{const vehicule=vehicules.find(v=>v.id===vehiculeId);return vehicule&&vehicule.immatriculation.toLowerCase().includes(searchTerm);});});}setFilteredTournees(results);},[quickSearch,tournees,vehicules,selectedPole]);// Effet pour gérer la sélection/désélection de toutes les tournées\nuseEffect(()=>{if(selectAll){setSelectedTournees(tournees.map(tournee=>tournee.id));}else if(selectedTournees.length===tournees.length){// Si toutes les tournées sont sélectionnées mais que selectAll est false, cela signifie que l'utilisateur a désélectionné\nsetSelectedTournees([]);}},[selectAll]);const fetchTournees=async()=>{try{setLoading(true);const tourneesRef=collection(db,'tournees');const snapshot=await getDocs(tourneesRef);if(!snapshot.empty){const tourneesData=snapshot.docs.map(doc=>{const data=doc.data();return{id:doc.id,nom:(data===null||data===void 0?void 0:data.nom)||'',heureDepart:(data===null||data===void 0?void 0:data.heureDepart)||'',heureFinPrevue:(data===null||data===void 0?void 0:data.heureFinPrevue)||'',heureFinReelle:(data===null||data===void 0?void 0:data.heureFinReelle)||'',coursier:(data===null||data===void 0?void 0:data.coursier)||'',vehicules:(data===null||data===void 0?void 0:data.vehicules)||[],nombreColis:(data===null||data===void 0?void 0:data.nombreColis)||0,statut:(data===null||data===void 0?void 0:data.statut)||'en_attente',pole:(data===null||data===void 0?void 0:data.pole)||'',siteDepart:(data===null||data===void 0?void 0:data.siteDepart)||''};});console.log(\"Tournées récupérées depuis Firestore:\",tourneesData);setTournees(tourneesData);}setLoading(false);}catch(error){console.error('Erreur lors de la récupération des tournées:',error);setError('Erreur lors de la récupération des données');setTournees([]);setLoading(false);}};const fetchVehicules=async()=>{try{const vehiculesRef=collection(db,'vehicules');const snapshot=await getDocs(vehiculesRef);if(!snapshot.empty){const vehiculesData=snapshot.docs.map(doc=>{const data=doc.data();return{id:doc.id,immatriculation:(data===null||data===void 0?void 0:data.immatriculation)||''};});setVehicules(vehiculesData);}}catch(error){console.error('Erreur lors de la récupération des véhicules:',error);}};const fetchSites=async()=>{try{const sitesRef=collection(db,'sites');const snapshot=await getDocs(sitesRef);if(!snapshot.empty){const sitesData=snapshot.docs.map(doc=>{const data=doc.data();return{id:doc.id,nom:(data===null||data===void 0?void 0:data.nom)||''};});setSites(sitesData);}}catch(error){console.error('Erreur lors de la récupération des sites:',error);}};const handleInputChange=e=>{const{name,value}=e.target;if(name==='nombreColis'){setCurrentTournee(prev=>({...prev,[name]:parseInt(value,10)}));}else if(name==='vehicules'){const selectedVehicules=Array.from(e.target.selectedOptions,option=>option.value);setCurrentTournee(prev=>({...prev,vehicules:selectedVehicules}));}else{setCurrentTournee(prev=>({...prev,[name]:value}));}};const handleCreateOrUpdateTournee=async()=>{try{const tourneeToSave={...currentTournee,id:currentTournee.id||'',heureDepart:currentTournee.heureDepart||'',heureFinPrevue:currentTournee.heureFinPrevue||'',heureFinReelle:currentTournee.heureFinReelle||'',coursier:currentTournee.coursier||'',vehicules:currentTournee.vehicules||[],nombreColis:currentTournee.nombreColis||0,statut:currentTournee.statut||'en_attente'};if(isEditing){await updateDoc(doc(db,'tournees',tourneeToSave.id),{...tourneeToSave});}else{await addDoc(collection(db,'tournees'),{...tourneeToSave});}fetchTournees();closeModal();}catch(error){console.error('Erreur lors de la sauvegarde de la tournée',error);setError('Erreur lors de la sauvegarde de la tournée');}};const handleEdit=tournee=>{setCurrentTournee(tournee);setIsEditing(true);setIsModalOpen(true);};const handleDeleteSelected=async()=>{if(selectedTournees.length===0){alert('Veuillez sélectionner au moins une tournée à supprimer');return;}if(window.confirm(`Êtes-vous sûr de vouloir supprimer ${selectedTournees.length} tournée(s) ?`)){try{// Supprimer les tournées sélectionnées de Firestore\nconst deletePromises=selectedTournees.map(id=>deleteDoc(doc(db,'tournees',id)));await Promise.all(deletePromises);// Mettre à jour l'état local\nsetTournees(tournees.filter(tournee=>!selectedTournees.includes(tournee.id)));setSelectedTournees([]);setSelectAll(false);}catch(error){console.error('Erreur lors de la suppression:',error);setError('Erreur lors de la suppression');}}};// Fonction pour gérer la sélection/désélection de toutes les tournées\nconst handleSelectAllChange=()=>{setSelectAll(!selectAll);};const toggleEditMode=()=>{if(editMode){// Si on quitte le mode édition, réinitialiser les sélections et les modifications\nsetSelectedTournees([]);setEditingTournees({});setSelectAll(false);setNewTournees([]);// Rafraîchir les données depuis Firebase\nfetchTournees();}else{// Si on entre en mode édition, initialiser les sites en édition\nconst editingTourneesObj={};filteredTournees.forEach(tournee=>{editingTourneesObj[tournee.id]={...tournee};});setEditingTournees(editingTourneesObj);}// Inverser le mode édition\nsetEditMode(!editMode);// Réinitialiser la recherche rapide et les filtres\nsetQuickSearch('');setSelectedPole('');};const toggleTourneeSelection=id=>{if(selectedTournees.includes(id)){setSelectedTournees(selectedTournees.filter(tourneeId=>tourneeId!==id));// Si on désélectionne une tournée, on désactive aussi \"Tout sélectionner\"\nsetSelectAll(false);}else{setSelectedTournees([...selectedTournees,id]);// Si toutes les tournées sont sélectionnées, on active \"Tout sélectionner\"\nif(selectedTournees.length+1===tournees.length){setSelectAll(true);}}};const formatDate=date=>{if(!date)return'';try{// Si c'est un Timestamp\nif(date instanceof Timestamp){return date.toDate().toLocaleDateString('fr-FR');}// Si c'est une Date\nif(date instanceof Date){return date.toLocaleDateString('fr-FR');}return'';}catch(error){console.error('Erreur lors du formatage de la date:',error);return'';}};const convertTimestampToDate=timestamp=>{if(!timestamp)return null;try{if(timestamp instanceof Timestamp){return timestamp.toDate();}return null;}catch(error){console.error('Erreur lors de la conversion du timestamp:',error);return null;}};const getStatusClass=statut=>{switch(statut){case'en_attente':return'en-attente';case'en_cours':return'en-cours';case'terminee':return'livré';case'annulee':return'annulé';default:return'';}};const getStatusText=statut=>{switch(statut){case'en_attente':return'En attente';case'en_cours':return'En cours';case'terminee':return'Terminée';case'annulee':return'Annulée';default:return'';}};const addNewTourneeRow=()=>{// Forcer le mode édition si ce n'est pas déjà le cas\nif(!editMode){setEditMode(true);}const newTournee={id:`temp-${Date.now()}`,// Identifiant temporaire unique\nnom:'',heureDepart:'',heureFinPrevue:'',heureFinReelle:'',coursier:'',vehicules:[],nombreColis:0,statut:'en_attente'};// Ajouter la nouvelle ligne au début du tableau\nsetNewTournees(prevNewTournees=>[newTournee,...prevNewTournees]);// Ajouter un délai pour permettre le rendu\nsetTimeout(()=>{const firstInput=document.querySelector('.tournees-table-container .new-tournee-row input');if(firstInput){firstInput.focus();}},100);};const handleNewTourneeChange=(index,field,value)=>{const updatedNewTournees=[...newTournees];updatedNewTournees[index]={...updatedNewTournees[index],[field]:value};setNewTournees(updatedNewTournees);};const removeNewTourneeRow=index=>{const updatedNewTournees=newTournees.filter((_,i)=>i!==index);setNewTournees(updatedNewTournees);};const saveAllChanges=async()=>{try{console.log(\"Début de la sauvegarde des modifications...\");console.log(\"Tournées à mettre à jour:\",Object.keys(editingTournees).length);console.log(\"Nouvelles tournées à ajouter:\",newTournees.length);// Mettre à jour les tournées existantes\nconst updatePromises=Object.entries(editingTournees).map(async _ref=>{let[id,tournee]=_ref;try{console.log(`Mise à jour de la tournée ${id}:`,tournee);// Créer un objet avec uniquement les champs définis\nconst updateData={};// Vérifier et ajouter chaque champ s'il est défini\nif(tournee.nom!==undefined)updateData.nom=tournee.nom;if(tournee.heureDepart!==undefined)updateData.heureDepart=tournee.heureDepart;if(tournee.heureFinPrevue!==undefined)updateData.heureFinPrevue=tournee.heureFinPrevue;if(tournee.heureFinReelle!==undefined)updateData.heureFinReelle=tournee.heureFinReelle;if(tournee.coursier!==undefined)updateData.coursier=tournee.coursier;if(tournee.vehicules!==undefined)updateData.vehicules=tournee.vehicules;if(tournee.nombreColis!==undefined)updateData.nombreColis=tournee.nombreColis;if(tournee.statut!==undefined)updateData.statut=tournee.statut;if(tournee.pole!==undefined)updateData.pole=tournee.pole;await updateDoc(doc(db,'tournees',id),updateData);console.log(`Tournée ${id} mise à jour avec succès`);return id;}catch(error){console.error(`Erreur lors de la mise à jour de la tournée ${id}:`,error);throw error;}});// Ajouter les nouvelles tournées\nconst addPromises=newTournees.map(async(newTournee,index)=>{try{console.log(`Ajout de la nouvelle tournée à l'index ${index}:`,newTournee);// Supprimer l'ID temporaire avant l'ajout\nconst{id,...tourneeToAdd}=newTournee;// S'assurer que tous les champs requis sont présents\nconst tourneeComplete={...tourneeToAdd,vehicules:tourneeToAdd.vehicules||[],nombreColis:tourneeToAdd.nombreColis||0,statut:tourneeToAdd.statut||'en_attente'};const docRef=await addDoc(collection(db,'tournees'),tourneeComplete);console.log(`Nouvelle tournée ajoutée avec l'ID: ${docRef.id}`);return docRef.id;}catch(error){console.error(`Erreur lors de l'ajout de la nouvelle tournée à l'index ${index}:`,error);throw error;}});// Attendre que toutes les opérations soient terminées\nconst results=await Promise.allSettled([...updatePromises,...addPromises]);// Vérifier les résultats\nconst fulfilled=results.filter(result=>result.status==='fulfilled').length;const rejected=results.filter(result=>result.status==='rejected').length;console.log(`Opérations terminées: ${fulfilled} réussies, ${rejected} échouées`);if(rejected>0){console.warn(\"Certaines opérations ont échoué. Voir les erreurs ci-dessus.\");}// Réinitialiser les états\nsetEditingTournees({});setNewTournees([]);// Recharger les tournées\nawait fetchTournees();if(rejected>0){alert(`Modifications partiellement enregistrées. ${rejected} opérations ont échoué.`);}else{alert('Modifications enregistrées avec succès');}// Désactiver le mode édition après sauvegarde réussie\nsetEditMode(false);setSelectedTournees([]);setSelectAll(false);console.log('Toutes les modifications ont été enregistrées avec succès');return true;}catch(error){console.error('Erreur lors de la sauvegarde des modifications:',error);alert('Erreur lors de la sauvegarde des modifications. Veuillez réessayer.');throw error;}};const handleCellChange=(id,field,value)=>{console.log(`Mise à jour de la tournée ${id}, champ ${field} avec la valeur:`,value);setEditingTournees({...editingTournees,[id]:{...editingTournees[id],[field]:value}});};const formatDateForInput=date=>{if(!date)return'';const year=date.getFullYear();const month=(date.getMonth()+1).toString().padStart(2,'0');const day=date.getDate().toString().padStart(2,'0');return`${year}-${month}-${day}`;};const closeModal=()=>{setIsModalOpen(false);setIsEditing(false);setCurrentTournee({nom:'',heureDepart:'',heureFinPrevue:'',heureFinReelle:'',coursier:'',vehicules:[],nombreColis:0,statut:'en_attente'});};// Fonction pour gérer le changement de pôle\nconst handlePoleChange=pole=>{setSelectedPole(pole);};if(loading){return/*#__PURE__*/_jsxs(\"div\",{className:\"loading-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"loading-spinner\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Chargement des tourn\\xE9es...\"})]});}return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"section-header\",children:/*#__PURE__*/_jsx(\"h2\",{className:\"section-title\",children:\"Tourn\\xE9es\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"sticky-header-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"header-actions\",children:editMode?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"button\",{className:\"button\",onClick:saveAllChanges,disabled:loading||selectedTournees.length===0&&newTournees.length===0,style:{backgroundColor:'#4CAF50',// Vert\ncolor:'white',fontWeight:'bold'},title:\"Enregistrer les modifications\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-save\"}),\" Enr. \",selectedTournees.length>0||newTournees.length>0?`(${selectedTournees.length}${newTournees.length>0?`+${newTournees.length}`:''})`:'']}),/*#__PURE__*/_jsxs(\"button\",{className:\"button button-secondary\",onClick:()=>{if(window.confirm(\"Êtes-vous sûr de vouloir annuler toutes les modifications ?\")){setEditingTournees({});setNewTournees([]);setSelectedTournees([]);setSelectAll(false);setEditMode(false);}},style:{marginLeft:'5px'},disabled:loading,title:\"Annuler les modifications\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"}),\" Annuler\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"button\",onClick:addNewTourneeRow,style:{marginLeft:'5px',backgroundColor:'#FF9800',// Orange\ncolor:'white',fontWeight:'bold'},disabled:loading,title:\"Ajouter une nouvelle tourn\\xE9e\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus\"}),\" Ajouter\"]}),/*#__PURE__*/_jsxs(\"button\",{className:\"button button-danger\",onClick:handleDeleteSelected,disabled:selectedTournees.length===0||loading,style:{marginLeft:'5px',backgroundColor:'#f44336',color:'white',fontWeight:'bold'},title:\"Supprimer les tourn\\xE9es s\\xE9lectionn\\xE9es\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash-alt\"}),\" Sup. (\",selectedTournees.length,\")\"]})]}):/*#__PURE__*/_jsxs(\"button\",{className:\"button\",onClick:toggleEditMode,children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-edit\"}),\" Modifier\"]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"quick-search-container\",style:{marginTop:'10px'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"quick-search-input\",placeholder:\"Recherche rapide...\",value:quickSearch,onChange:e=>setQuickSearch(e.target.value),disabled:loading}),/*#__PURE__*/_jsx(\"div\",{className:\"pole-filter\",children:/*#__PURE__*/_jsx(PoleFilter,{onPoleChange:handlePoleChange,selectedPole:selectedPole,label:\"Filtrer par p\\xF4le\",className:\"pole-filter-component\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"tournees-table-container\",style:{overflowX:'auto'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"results-info\",children:/*#__PURE__*/_jsxs(\"p\",{children:[filteredTournees.length,\" r\\xE9sultat(s) trouv\\xE9(s)\",quickSearch?` pour la recherche \"${quickSearch}\"`:'']})}),/*#__PURE__*/_jsxs(\"table\",{className:`data-table ${editMode?'editing':''}`,children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[editMode&&/*#__PURE__*/_jsx(\"th\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectAll,onChange:handleSelectAllChange,title:\"S\\xE9lectionner/D\\xE9s\\xE9lectionner toutes les tourn\\xE9es\"})}),/*#__PURE__*/_jsx(\"th\",{children:\"P\\xD4LE\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Nom\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Heure de D\\xE9part\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Heure d'Arriv\\xE9e\"}),/*#__PURE__*/_jsx(\"th\",{children:\"V\\xE9hicules\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Statut\"})]})}),/*#__PURE__*/_jsxs(\"tbody\",{children:[editMode&&newTournees.map((newTournee,index)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"new-tournee-row\",children:[/*#__PURE__*/_jsx(\"td\",{style:{display:'none'}}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(PoleSelector,{value:newTournee.pole||'',onChange:value=>handleNewTourneeChange(index,'pole',value),placeholder:\"S\\xE9lectionner un p\\xF4le\",style:{width:'100%'},showSearch:true,allowClear:true,title:\"P\\xF4le de la tourn\\xE9e\"})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:newTournee.nom||'',onChange:e=>handleNewTourneeChange(index,'nom',e.target.value),className:\"inline-edit-input\",placeholder:\"Nom de la tourn\\xE9e\"})}),/*#__PURE__*/_jsx(\"td\",{style:{position:'relative'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"custom-datepicker-wrapper\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:newTournee.heureDepart?new Date(`2000-01-01T${newTournee.heureDepart}`):null,onChange:date=>{if(date){const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');handleNewTourneeChange(index,'heureDepart',`${hours}:${minutes}`);}},locale:\"fr\",showTimeSelect:true,showTimeSelectOnly:true,timeIntervals:15,timeCaption:\"Heure\",dateFormat:\"HH:mm\",placeholderText:\"HH:MM\",className:\"custom-datepicker-input\",popperPlacement:\"bottom-start\",popperModifiers:[{name:'offset',options:{offset:[0,8]},fn:state=>state}]}),/*#__PURE__*/_jsx(\"span\",{className:\"custom-datepicker-icon\",children:\"\\uD83D\\uDD52\"})]})}),/*#__PURE__*/_jsx(\"td\",{style:{position:'relative'},children:/*#__PURE__*/_jsxs(\"div\",{className:\"custom-datepicker-wrapper\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:newTournee.heureFinReelle?new Date(`2000-01-01T${newTournee.heureFinReelle}`):null,onChange:date=>{if(date){const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');handleNewTourneeChange(index,'heureFinReelle',`${hours}:${minutes}`);}},locale:\"fr\",showTimeSelect:true,showTimeSelectOnly:true,timeIntervals:15,timeCaption:\"Heure\",dateFormat:\"HH:mm\",placeholderText:\"HH:MM\",className:\"custom-datepicker-input\",popperPlacement:\"bottom-start\",popperModifiers:[{name:'offset',options:{offset:[0,8]},fn:state=>state}]}),/*#__PURE__*/_jsx(\"span\",{className:\"custom-datepicker-icon\",children:\"\\uD83D\\uDD52\"})]})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"div\",{className:\"checkbox-list\",style:{maxHeight:'150px',overflowY:'auto',border:'1px solid #ddd',borderRadius:'4px',padding:'8px',backgroundColor:'#f9f9f9'},children:vehicules.map(vehicule=>/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'6px'},children:/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:(newTournee.vehicules||[]).includes(vehicule.id),onChange:e=>{const currentVehicules=[...(newTournee.vehicules||[])];if(e.target.checked){// Ajouter le véhicule s'il n'est pas déjà présent\nif(!currentVehicules.includes(vehicule.id)){handleNewTourneeChange(index,'vehicules',[...currentVehicules,vehicule.id]);}}else{// Retirer le véhicule\nhandleNewTourneeChange(index,'vehicules',currentVehicules.filter(id=>id!==vehicule.id));}},style:{marginRight:'8px'},title:`Sélectionner le véhicule ${vehicule.immatriculation}`}),vehicule.immatriculation]})},vehicule.id))})}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"select\",{value:newTournee.statut||'en_attente',onChange:e=>handleNewTourneeChange(index,'statut',e.target.value),className:\"inline-edit-select\",title:\"Statut de la tourn\\xE9e\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"en_attente\",children:\"En attente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"en_cours\",children:\"En cours\"}),/*#__PURE__*/_jsx(\"option\",{value:\"terminee\",children:\"Termin\\xE9e\"}),/*#__PURE__*/_jsx(\"option\",{value:\"annulee\",children:\"Annul\\xE9e\"})]})})]},newTournee.id)),filteredTournees.map(tournee=>{var _editingTournees$tour,_editingTournees$tour2,_editingTournees$tour3,_editingTournees$tour4,_editingTournees$tour7;return/*#__PURE__*/_jsxs(\"tr\",{className:selectedTournees.includes(tournee.id)?'selected-row':'',children:[editMode&&/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:selectedTournees.includes(tournee.id),onChange:()=>toggleTourneeSelection(tournee.id),title:`Sélectionner la tournée ${tournee.nom}`})}),/*#__PURE__*/_jsx(\"td\",{children:editMode?/*#__PURE__*/_jsx(PoleSelector,{value:((_editingTournees$tour=editingTournees[tournee.id])===null||_editingTournees$tour===void 0?void 0:_editingTournees$tour.pole)||tournee.pole||'',onChange:value=>handleCellChange(tournee.id,'pole',value),placeholder:\"S\\xE9lectionner un p\\xF4le\",style:{width:'100%'},showSearch:true,allowClear:true,title:\"P\\xF4le de la tourn\\xE9e\"}):getPoleNameById(tournee.pole)}),/*#__PURE__*/_jsx(\"td\",{children:editMode?/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:((_editingTournees$tour2=editingTournees[tournee.id])===null||_editingTournees$tour2===void 0?void 0:_editingTournees$tour2.nom)||tournee.nom,onChange:e=>handleCellChange(tournee.id,'nom',e.target.value),className:\"inline-edit-input\",placeholder:\"Nom de la tourn\\xE9e\"}):tournee.nom}),/*#__PURE__*/_jsx(\"td\",{style:{position:'relative'},children:editMode?/*#__PURE__*/_jsxs(\"div\",{className:\"custom-datepicker-wrapper\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:(_editingTournees$tour3=editingTournees[tournee.id])!==null&&_editingTournees$tour3!==void 0&&_editingTournees$tour3.heureDepart?new Date(`2000-01-01T${editingTournees[tournee.id].heureDepart}`):tournee.heureDepart?new Date(`2000-01-01T${tournee.heureDepart}`):null,onChange:date=>{if(date){const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');handleCellChange(tournee.id,'heureDepart',`${hours}:${minutes}`);}},locale:\"fr\",showTimeSelect:true,showTimeSelectOnly:true,timeIntervals:15,timeCaption:\"Heure\",dateFormat:\"HH:mm\",placeholderText:\"HH:MM\",className:\"custom-datepicker-input\",popperPlacement:\"bottom-start\",popperModifiers:[{name:'offset',options:{offset:[0,8]},fn:state=>state}]}),/*#__PURE__*/_jsx(\"span\",{className:\"custom-datepicker-icon\",children:\"\\uD83D\\uDD52\"})]}):tournee.heureDepart||'-'}),/*#__PURE__*/_jsx(\"td\",{style:{position:'relative'},children:editMode?/*#__PURE__*/_jsxs(\"div\",{className:\"custom-datepicker-wrapper\",children:[/*#__PURE__*/_jsx(DatePicker,{selected:(_editingTournees$tour4=editingTournees[tournee.id])!==null&&_editingTournees$tour4!==void 0&&_editingTournees$tour4.heureFinReelle?new Date(`2000-01-01T${editingTournees[tournee.id].heureFinReelle}`):tournee.heureFinReelle?new Date(`2000-01-01T${tournee.heureFinReelle}`):null,onChange:date=>{if(date){const hours=date.getHours().toString().padStart(2,'0');const minutes=date.getMinutes().toString().padStart(2,'0');handleCellChange(tournee.id,'heureFinReelle',`${hours}:${minutes}`);}},locale:\"fr\",showTimeSelect:true,showTimeSelectOnly:true,timeIntervals:15,timeCaption:\"Heure\",dateFormat:\"HH:mm\",placeholderText:\"HH:MM\",className:\"custom-datepicker-input\",popperPlacement:\"bottom-start\",popperModifiers:[{name:'offset',options:{offset:[0,8]},fn:state=>state}]}),/*#__PURE__*/_jsx(\"span\",{className:\"custom-datepicker-icon\",children:\"\\uD83D\\uDD52\"})]}):tournee.heureFinReelle||'-'}),/*#__PURE__*/_jsx(\"td\",{children:editMode?/*#__PURE__*/_jsx(\"div\",{className:\"checkbox-list\",style:{maxHeight:'150px',overflowY:'auto',border:'1px solid #ddd',borderRadius:'4px',padding:'8px',backgroundColor:'#f9f9f9'},children:vehicules.map(vehicule=>{var _editingTournees$tour5;return/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'6px'},children:/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:(((_editingTournees$tour5=editingTournees[tournee.id])===null||_editingTournees$tour5===void 0?void 0:_editingTournees$tour5.vehicules)||tournee.vehicules).includes(vehicule.id),onChange:e=>{var _editingTournees$tour6;const currentVehicules=[...(((_editingTournees$tour6=editingTournees[tournee.id])===null||_editingTournees$tour6===void 0?void 0:_editingTournees$tour6.vehicules)||tournee.vehicules)];if(e.target.checked){// Ajouter le véhicule s'il n'est pas déjà présent\nif(!currentVehicules.includes(vehicule.id)){handleCellChange(tournee.id,'vehicules',[...currentVehicules,vehicule.id]);}}else{// Retirer le véhicule\nhandleCellChange(tournee.id,'vehicules',currentVehicules.filter(id=>id!==vehicule.id));}},style:{marginRight:'8px'}}),vehicule.immatriculation]})},vehicule.id);})}):tournee.vehicules.map(vehiculeId=>{const vehicule=vehicules.find(v=>v.id===vehiculeId);return vehicule?vehicule.immatriculation:vehiculeId;}).join(', ')}),/*#__PURE__*/_jsx(\"td\",{children:editMode?/*#__PURE__*/_jsxs(\"select\",{value:((_editingTournees$tour7=editingTournees[tournee.id])===null||_editingTournees$tour7===void 0?void 0:_editingTournees$tour7.statut)||tournee.statut,onChange:e=>handleCellChange(tournee.id,'statut',e.target.value),className:\"inline-edit-select\",title:\"Statut de la tourn\\xE9e\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"en_attente\",children:\"En attente\"}),/*#__PURE__*/_jsx(\"option\",{value:\"en_cours\",children:\"En cours\"}),/*#__PURE__*/_jsx(\"option\",{value:\"terminee\",children:\"Termin\\xE9e\"}),/*#__PURE__*/_jsx(\"option\",{value:\"annulee\",children:\"Annul\\xE9e\"})]}):/*#__PURE__*/_jsx(\"span\",{className:getStatusClass(tournee.statut),children:getStatusText(tournee.statut)})})]},tournee.id);})]})]})]})]});};export default Tournees;","map":{"version":3,"names":["React","useState","useEffect","collection","getDocs","addDoc","updateDoc","deleteDoc","doc","Timestamp","db","DatePicker","registerLocale","fr","usePoles","PoleSelector","PoleFilter","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","Tournees","tournees","setTournees","loading","setLoading","error","setError","isModalOpen","setIsModalOpen","isEditing","setIsEditing","currentTournee","setCurrentTournee","nom","heureDepart","heureFinPrevue","heureFinReelle","coursier","vehicules","nombreColis","statut","editMode","setEditMode","selectedTournees","setSelectedTournees","editingTournees","setEditingTournees","setVehicules","sites","setSites","selectAll","setSelectAll","newTournees","setNewTournees","quickSearch","setQuickSearch","filteredTournees","setFilteredTournees","selectedPole","setSelectedPole","poles","getPoleNameById","poleId","pole","find","p","id","fetchTournees","fetchVehicules","fetchSites","results","filter","tournee","trim","searchTerm","toLowerCase","includes","some","vehiculeId","vehicule","v","immatriculation","map","length","tourneesRef","snapshot","empty","tourneesData","docs","data","siteDepart","console","log","vehiculesRef","vehiculesData","sitesRef","sitesData","handleInputChange","e","name","value","target","prev","parseInt","selectedVehicules","Array","from","selectedOptions","option","handleCreateOrUpdateTournee","tourneeToSave","closeModal","handleEdit","handleDeleteSelected","alert","window","confirm","deletePromises","Promise","all","handleSelectAllChange","toggleEditMode","editingTourneesObj","forEach","toggleTourneeSelection","tourneeId","formatDate","date","toDate","toLocaleDateString","Date","convertTimestampToDate","timestamp","getStatusClass","getStatusText","addNewTourneeRow","newTournee","now","prevNewTournees","setTimeout","firstInput","document","querySelector","focus","handleNewTourneeChange","index","field","updatedNewTournees","removeNewTourneeRow","_","i","saveAllChanges","Object","keys","updatePromises","entries","_ref","updateData","undefined","addPromises","tourneeToAdd","tourneeComplete","docRef","allSettled","fulfilled","result","status","rejected","warn","handleCellChange","formatDateForInput","year","getFullYear","month","getMonth","toString","padStart","day","getDate","handlePoleChange","className","children","onClick","disabled","style","backgroundColor","color","fontWeight","title","marginLeft","marginTop","type","placeholder","onChange","onPoleChange","label","overflowX","checked","display","width","showSearch","allowClear","position","selected","hours","getHours","minutes","getMinutes","locale","showTimeSelect","showTimeSelectOnly","timeIntervals","timeCaption","dateFormat","placeholderText","popperPlacement","popperModifiers","options","offset","fn","state","maxHeight","overflowY","border","borderRadius","padding","marginBottom","alignItems","cursor","currentVehicules","marginRight","_editingTournees$tour","_editingTournees$tour2","_editingTournees$tour3","_editingTournees$tour4","_editingTournees$tour7","_editingTournees$tour5","_editingTournees$tour6","join"],"sources":["C:/Users/LS_110/Documents/GitHub/inovie-SCAN-web-main/src/components/Tournees.tsx"],"sourcesContent":["// @ts-nocheck\r\nimport React, { \r\n  useState, \r\n  useEffect, \r\n  ChangeEvent, \r\n  FormEvent \r\n} from 'react';\r\nimport { \r\n  collection, \r\n  getDocs, \r\n  addDoc, \r\n  updateDoc, \r\n  deleteDoc, \r\n  doc, \r\n  Timestamp,\r\n  DocumentSnapshot,\r\n  QueryDocumentSnapshot,\r\n  DocumentData\r\n} from 'firebase/firestore';\r\nimport { db } from '../config/firebase';\r\nimport DatePicker from 'react-datepicker';\r\nimport { registerLocale } from 'react-datepicker';\r\nimport { fr } from 'date-fns/locale';\r\nimport 'react-datepicker/dist/react-datepicker.css';\r\nimport './EditMode.css';\r\nimport './Tournees.css';\r\nimport ReactDOM from 'react-dom';\r\nimport { usePoles } from '../services/PoleService';\r\nimport PoleSelector from './PoleSelector';\r\nimport PoleFilter from './PoleFilter';\r\n\r\n// Enregistrer la locale française\r\nregisterLocale('fr', fr);\r\n\r\ninterface Tournee {\r\n  id: string;\r\n  nom: string;\r\n  date: Timestamp;\r\n  heureDepart: string;\r\n  heureFinPrevue: string;\r\n  heureFinReelle?: string;\r\n  coursier: string;\r\n  vehicules: string[];\r\n  nombreColis: number;\r\n  statut: 'en_attente' | 'en_cours' | 'terminee' | 'annulee';\r\n  siteDepart: string;\r\n  pole?: string;\r\n}\r\n\r\ninterface Vehicule {\r\n  id: string;\r\n  immatriculation: string;\r\n}\r\n\r\ninterface Site {\r\n  id: string;\r\n  nom: string;\r\n}\r\n\r\nconst Tournees: React.FC = () => {\r\n  const [tournees, setTournees] = useState<Tournee[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  \r\n  // État pour le modal\r\n  const [isModalOpen, setIsModalOpen] = useState<boolean>(false);\r\n  const [isEditing, setIsEditing] = useState<boolean>(false);\r\n  const [currentTournee, setCurrentTournee] = useState<Partial<Tournee>>({\r\n    nom: '',\r\n    heureDepart: '',\r\n    heureFinPrevue: '',\r\n    heureFinReelle: '',\r\n    coursier: '',\r\n    vehicules: [],\r\n    nombreColis: 0,\r\n    statut: 'en_attente',\r\n  });\r\n\r\n  // État pour le mode édition et la sélection multiple\r\n  const [editMode, setEditMode] = useState<boolean>(false);\r\n  const [selectedTournees, setSelectedTournees] = useState<string[]>([]);\r\n  const [editingTournees, setEditingTournees] = useState<{[key: string]: Tournee}>({});\r\n  const [vehicules, setVehicules] = useState<Vehicule[]>([]);\r\n  const [sites, setSites] = useState<Site[]>([]);\r\n  const [selectAll, setSelectAll] = useState<boolean>(false);\r\n\r\n  // Ajouter un nouvel état pour les nouvelles tournées temporaires\r\n  const [newTournees, setNewTournees] = useState<Partial<Tournee>[]>([]);\r\n  \r\n  // État pour la recherche rapide\r\n  const [quickSearch, setQuickSearch] = useState<string>('');\r\n  const [filteredTournees, setFilteredTournees] = useState<Tournee[]>([]);\r\n\r\n  // Ajout du filtre par pôle\r\n  const [selectedPole, setSelectedPole] = useState<string>('');\r\n\r\n  // Utilisation du hook usePoles\r\n  const { poles } = usePoles();\r\n  \r\n  // Fonction pour obtenir le nom du pôle\r\n  const getPoleNameById = (poleId: string | undefined): string => {\r\n    if (!poleId) return '-';\r\n    const pole = poles.find(p => p.id === poleId);\r\n    return pole ? pole.nom : poleId;\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchTournees();\r\n    fetchVehicules();\r\n    fetchSites();\r\n  }, []);\r\n\r\n  // Initialiser les tournées filtrées au chargement\r\n  useEffect(() => {\r\n    setFilteredTournees(tournees);\r\n  }, [tournees]);\r\n\r\n  // Effet pour filtrer les tournées en fonction de la recherche rapide et du pôle sélectionné\r\n  useEffect(() => {\r\n    let results = tournees;\r\n\r\n    // Filtrer par pôle si un pôle est sélectionné\r\n    if (selectedPole) {\r\n      results = results.filter(tournee => tournee.pole === selectedPole);\r\n    }\r\n\r\n    // Ensuite filtrer par recherche rapide\r\n    if (quickSearch.trim()) {\r\n      const searchTerm = quickSearch.toLowerCase().trim();\r\n      results = results.filter(tournee => {\r\n        // Rechercher dans tous les champs textuels de la tournée\r\n        return (\r\n          tournee.nom.toLowerCase().includes(searchTerm) ||\r\n          tournee.heureDepart.toLowerCase().includes(searchTerm) ||\r\n          (tournee.heureFinReelle || '').toLowerCase().includes(searchTerm) ||\r\n          tournee.statut.toLowerCase().includes(searchTerm) ||\r\n          tournee.vehicules.some(vehiculeId => {\r\n            const vehicule = vehicules.find(v => v.id === vehiculeId);\r\n            return vehicule && vehicule.immatriculation.toLowerCase().includes(searchTerm);\r\n          })\r\n        );\r\n      });\r\n    }\r\n\r\n    setFilteredTournees(results);\r\n  }, [quickSearch, tournees, vehicules, selectedPole]);\r\n\r\n  // Effet pour gérer la sélection/désélection de toutes les tournées\r\n  useEffect(() => {\r\n    if (selectAll) {\r\n      setSelectedTournees(tournees.map(tournee => tournee.id));\r\n    } else if (selectedTournees.length === tournees.length) {\r\n      // Si toutes les tournées sont sélectionnées mais que selectAll est false, cela signifie que l'utilisateur a désélectionné\r\n      setSelectedTournees([]);\r\n    }\r\n  }, [selectAll]);\r\n\r\n  const fetchTournees = async () => {\r\n    try {\r\n      setLoading(true);\r\n      \r\n      const tourneesRef = collection(db, 'tournees');\r\n      const snapshot = await getDocs(tourneesRef);\r\n      \r\n      if (!snapshot.empty) {\r\n        const tourneesData: Tournee[] = snapshot.docs.map((doc: DocumentSnapshot<DocumentData>) => {\r\n          const data = doc.data() as Tournee;\r\n          return {\r\n            id: doc.id,\r\n            nom: data?.nom || '',\r\n            heureDepart: data?.heureDepart || '',\r\n            heureFinPrevue: data?.heureFinPrevue || '',\r\n            heureFinReelle: data?.heureFinReelle || '',\r\n            coursier: data?.coursier || '',\r\n            vehicules: data?.vehicules || [],\r\n            nombreColis: data?.nombreColis || 0,\r\n            statut: data?.statut || 'en_attente',\r\n            pole: data?.pole || '',\r\n            siteDepart: data?.siteDepart || ''\r\n          };\r\n        });\r\n        \r\n        console.log(\"Tournées récupérées depuis Firestore:\", tourneesData);\r\n        setTournees(tourneesData);\r\n      }\r\n      \r\n      setLoading(false);\r\n    } catch (error) {\r\n      console.error('Erreur lors de la récupération des tournées:', error);\r\n      setError('Erreur lors de la récupération des données');\r\n      setTournees([]);\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchVehicules = async () => {\r\n    try {\r\n      const vehiculesRef = collection(db, 'vehicules');\r\n      const snapshot = await getDocs(vehiculesRef);\r\n      \r\n      if (!snapshot.empty) {\r\n        const vehiculesData: Vehicule[] = snapshot.docs.map((doc: DocumentSnapshot<DocumentData>) => {\r\n          const data = doc.data() as Vehicule;\r\n          return {\r\n            id: doc.id,\r\n            immatriculation: data?.immatriculation || ''\r\n          };\r\n        });\r\n        \r\n        setVehicules(vehiculesData);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erreur lors de la récupération des véhicules:', error);\r\n    }\r\n  };\r\n\r\n  const fetchSites = async () => {\r\n    try {\r\n      const sitesRef = collection(db, 'sites');\r\n      const snapshot = await getDocs(sitesRef);\r\n      \r\n      if (!snapshot.empty) {\r\n        const sitesData: Site[] = snapshot.docs.map((doc: DocumentSnapshot<DocumentData>) => {\r\n          const data = doc.data() as Site;\r\n          return {\r\n            id: doc.id,\r\n            nom: data?.nom || ''\r\n          };\r\n        });\r\n        \r\n        setSites(sitesData);\r\n      }\r\n    } catch (error) {\r\n      console.error('Erreur lors de la récupération des sites:', error);\r\n    }\r\n  };\r\n\r\n  const handleInputChange = (e: ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n    const { name, value } = e.target;\r\n    \r\n    if (name === 'nombreColis') {\r\n      setCurrentTournee((prev: Partial<Tournee>) => ({ \r\n        ...prev, \r\n        [name]: parseInt(value, 10) \r\n      }));\r\n    } else if (name === 'vehicules') {\r\n      const selectedVehicules = Array.from(\r\n        (e.target as HTMLSelectElement).selectedOptions, \r\n        option => option.value\r\n      );\r\n      setCurrentTournee((prev: Partial<Tournee>) => ({ \r\n        ...prev, \r\n        vehicules: selectedVehicules \r\n      }));\r\n    } else {\r\n      setCurrentTournee((prev: Partial<Tournee>) => ({ ...prev, [name]: value }));\r\n    }\r\n  };\r\n\r\n  const handleCreateOrUpdateTournee = async () => {\r\n    try {\r\n      const tourneeToSave: Tournee = {\r\n        ...currentTournee,\r\n        id: currentTournee.id || '',\r\n        heureDepart: currentTournee.heureDepart || '',\r\n        heureFinPrevue: currentTournee.heureFinPrevue || '',\r\n        heureFinReelle: currentTournee.heureFinReelle || '',\r\n        coursier: currentTournee.coursier || '',\r\n        vehicules: currentTournee.vehicules || [],\r\n        nombreColis: currentTournee.nombreColis || 0,\r\n        statut: currentTournee.statut || 'en_attente',\r\n      } as Tournee;\r\n\r\n      if (isEditing) {\r\n        await updateDoc(doc(db, 'tournees', tourneeToSave.id), {\r\n          ...tourneeToSave,\r\n        });\r\n      } else {\r\n        await addDoc(collection(db, 'tournees'), {\r\n          ...tourneeToSave,\r\n        });\r\n      }\r\n\r\n      fetchTournees();\r\n      closeModal();\r\n    } catch (error) {\r\n      console.error('Erreur lors de la sauvegarde de la tournée', error);\r\n      setError('Erreur lors de la sauvegarde de la tournée');\r\n    }\r\n  };\r\n\r\n  const handleEdit = (tournee: Tournee) => {\r\n    setCurrentTournee(tournee);\r\n    setIsEditing(true);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  const handleDeleteSelected = async () => {\r\n    if (selectedTournees.length === 0) {\r\n      alert('Veuillez sélectionner au moins une tournée à supprimer');\r\n      return;\r\n    }\r\n\r\n    if (window.confirm(`Êtes-vous sûr de vouloir supprimer ${selectedTournees.length} tournée(s) ?`)) {\r\n      try {\r\n        // Supprimer les tournées sélectionnées de Firestore\r\n        const deletePromises = selectedTournees.map(id => deleteDoc(doc(db, 'tournees', id)));\r\n        await Promise.all(deletePromises);\r\n        \r\n        // Mettre à jour l'état local\r\n        setTournees(tournees.filter(tournee => !selectedTournees.includes(tournee.id)));\r\n        setSelectedTournees([]);\r\n        setSelectAll(false);\r\n      } catch (error) {\r\n        console.error('Erreur lors de la suppression:', error);\r\n        setError('Erreur lors de la suppression');\r\n      }\r\n    }\r\n  };\r\n\r\n  // Fonction pour gérer la sélection/désélection de toutes les tournées\r\n  const handleSelectAllChange = () => {\r\n    setSelectAll(!selectAll);\r\n  };\r\n\r\n  const toggleEditMode = () => {\r\n    if (editMode) {\r\n      // Si on quitte le mode édition, réinitialiser les sélections et les modifications\r\n      setSelectedTournees([]);\r\n      setEditingTournees({});\r\n      setSelectAll(false);\r\n      setNewTournees([]);\r\n      \r\n      // Rafraîchir les données depuis Firebase\r\n      fetchTournees();\r\n    } else {\r\n      // Si on entre en mode édition, initialiser les sites en édition\r\n      const editingTourneesObj: {[key: string]: Tournee} = {};\r\n      filteredTournees.forEach(tournee => {\r\n        editingTourneesObj[tournee.id] = { ...tournee };\r\n      });\r\n      setEditingTournees(editingTourneesObj);\r\n    }\r\n    \r\n    // Inverser le mode édition\r\n    setEditMode(!editMode);\r\n    \r\n    // Réinitialiser la recherche rapide et les filtres\r\n    setQuickSearch('');\r\n    setSelectedPole('');\r\n  };\r\n\r\n  const toggleTourneeSelection = (id: string) => {\r\n    if (selectedTournees.includes(id)) {\r\n      setSelectedTournees(selectedTournees.filter(tourneeId => tourneeId !== id));\r\n      // Si on désélectionne une tournée, on désactive aussi \"Tout sélectionner\"\r\n      setSelectAll(false);\r\n    } else {\r\n      setSelectedTournees([...selectedTournees, id]);\r\n      // Si toutes les tournées sont sélectionnées, on active \"Tout sélectionner\"\r\n      if (selectedTournees.length + 1 === tournees.length) {\r\n        setSelectAll(true);\r\n      }\r\n    }\r\n  };\r\n\r\n  const formatDate = (date: Date | Timestamp | null) => {\r\n    if (!date) return '';\r\n    \r\n    try {\r\n      // Si c'est un Timestamp\r\n      if (date instanceof Timestamp) {\r\n        return date.toDate().toLocaleDateString('fr-FR');\r\n      }\r\n      \r\n      // Si c'est une Date\r\n      if (date instanceof Date) {\r\n        return date.toLocaleDateString('fr-FR');\r\n      }\r\n      \r\n      return '';\r\n    } catch (error) {\r\n      console.error('Erreur lors du formatage de la date:', error);\r\n      return '';\r\n    }\r\n  };\r\n\r\n  const convertTimestampToDate = (timestamp: any): Date | null => {\r\n    if (!timestamp) return null;\r\n    try {\r\n      if (timestamp instanceof Timestamp) {\r\n        return timestamp.toDate();\r\n      }\r\n      return null;\r\n    } catch (error) {\r\n      console.error('Erreur lors de la conversion du timestamp:', error);\r\n      return null;\r\n    }\r\n  };\r\n\r\n  const getStatusClass = (statut: string) => {\r\n    switch (statut) {\r\n      case 'en_attente':\r\n        return 'en-attente';\r\n      case 'en_cours':\r\n        return 'en-cours';\r\n      case 'terminee':\r\n        return 'livré';\r\n      case 'annulee':\r\n        return 'annulé';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const getStatusText = (statut: string) => {\r\n    switch (statut) {\r\n      case 'en_attente':\r\n        return 'En attente';\r\n      case 'en_cours':\r\n        return 'En cours';\r\n      case 'terminee':\r\n        return 'Terminée';\r\n      case 'annulee':\r\n        return 'Annulée';\r\n      default:\r\n        return '';\r\n    }\r\n  };\r\n\r\n  const addNewTourneeRow = () => {\r\n    // Forcer le mode édition si ce n'est pas déjà le cas\r\n    if (!editMode) {\r\n      setEditMode(true);\r\n    }\r\n\r\n    const newTournee: Partial<Tournee> = {\r\n      id: `temp-${Date.now()}`, // Identifiant temporaire unique\r\n      nom: '',\r\n      heureDepart: '',\r\n      heureFinPrevue: '',\r\n      heureFinReelle: '',\r\n      coursier: '',\r\n      vehicules: [],\r\n      nombreColis: 0,\r\n      statut: 'en_attente',\r\n    };\r\n    \r\n    // Ajouter la nouvelle ligne au début du tableau\r\n    setNewTournees(prevNewTournees => [newTournee, ...prevNewTournees]);\r\n    \r\n    // Ajouter un délai pour permettre le rendu\r\n    setTimeout(() => {\r\n      const firstInput = document.querySelector('.tournees-table-container .new-tournee-row input') as HTMLInputElement;\r\n      if (firstInput) {\r\n        firstInput.focus();\r\n      }\r\n    }, 100);\r\n  };\r\n\r\n  const handleNewTourneeChange = (index: number, field: keyof Tournee, value: any) => {\r\n    const updatedNewTournees = [...newTournees];\r\n    updatedNewTournees[index] = {\r\n      ...updatedNewTournees[index],\r\n      [field]: value\r\n    };\r\n    setNewTournees(updatedNewTournees);\r\n  };\r\n\r\n  const removeNewTourneeRow = (index: number) => {\r\n    const updatedNewTournees = newTournees.filter((_, i) => i !== index);\r\n    setNewTournees(updatedNewTournees);\r\n  };\r\n\r\n  const saveAllChanges = async () => {\r\n    try {\r\n      console.log(\"Début de la sauvegarde des modifications...\");\r\n      console.log(\"Tournées à mettre à jour:\", Object.keys(editingTournees).length);\r\n      console.log(\"Nouvelles tournées à ajouter:\", newTournees.length);\r\n      \r\n      // Mettre à jour les tournées existantes\r\n      const updatePromises = Object.entries(editingTournees).map(async ([id, tournee]) => {\r\n        try {\r\n          console.log(`Mise à jour de la tournée ${id}:`, tournee);\r\n          \r\n          // Créer un objet avec uniquement les champs définis\r\n          const updateData: Partial<Tournee> = {};\r\n          \r\n          // Vérifier et ajouter chaque champ s'il est défini\r\n          if (tournee.nom !== undefined) updateData.nom = tournee.nom;\r\n          if (tournee.heureDepart !== undefined) updateData.heureDepart = tournee.heureDepart;\r\n          if (tournee.heureFinPrevue !== undefined) updateData.heureFinPrevue = tournee.heureFinPrevue;\r\n          if (tournee.heureFinReelle !== undefined) updateData.heureFinReelle = tournee.heureFinReelle;\r\n          if (tournee.coursier !== undefined) updateData.coursier = tournee.coursier;\r\n          if (tournee.vehicules !== undefined) updateData.vehicules = tournee.vehicules;\r\n          if (tournee.nombreColis !== undefined) updateData.nombreColis = tournee.nombreColis;\r\n          if (tournee.statut !== undefined) updateData.statut = tournee.statut;\r\n          if (tournee.pole !== undefined) updateData.pole = tournee.pole;\r\n          \r\n          await updateDoc(doc(db, 'tournees', id), updateData);\r\n          console.log(`Tournée ${id} mise à jour avec succès`);\r\n          return id;\r\n        } catch (error) {\r\n          console.error(`Erreur lors de la mise à jour de la tournée ${id}:`, error);\r\n          throw error;\r\n        }\r\n      });\r\n\r\n      // Ajouter les nouvelles tournées\r\n      const addPromises = newTournees.map(async (newTournee, index) => {\r\n        try {\r\n          console.log(`Ajout de la nouvelle tournée à l'index ${index}:`, newTournee);\r\n          \r\n          // Supprimer l'ID temporaire avant l'ajout\r\n          const { id, ...tourneeToAdd } = newTournee;\r\n          \r\n          // S'assurer que tous les champs requis sont présents\r\n          const tourneeComplete = {\r\n            ...tourneeToAdd,\r\n            vehicules: tourneeToAdd.vehicules || [],\r\n            nombreColis: tourneeToAdd.nombreColis || 0,\r\n            statut: tourneeToAdd.statut || 'en_attente'\r\n          };\r\n          \r\n          const docRef = await addDoc(collection(db, 'tournees'), tourneeComplete);\r\n          console.log(`Nouvelle tournée ajoutée avec l'ID: ${docRef.id}`);\r\n          return docRef.id;\r\n        } catch (error) {\r\n          console.error(`Erreur lors de l'ajout de la nouvelle tournée à l'index ${index}:`, error);\r\n          throw error;\r\n        }\r\n      });\r\n\r\n      // Attendre que toutes les opérations soient terminées\r\n      const results = await Promise.allSettled([...updatePromises, ...addPromises]);\r\n      \r\n      // Vérifier les résultats\r\n      const fulfilled = results.filter(result => result.status === 'fulfilled').length;\r\n      const rejected = results.filter(result => result.status === 'rejected').length;\r\n      \r\n      console.log(`Opérations terminées: ${fulfilled} réussies, ${rejected} échouées`);\r\n      \r\n      if (rejected > 0) {\r\n        console.warn(\"Certaines opérations ont échoué. Voir les erreurs ci-dessus.\");\r\n      }\r\n      \r\n      // Réinitialiser les états\r\n      setEditingTournees({});\r\n      setNewTournees([]);\r\n      \r\n      // Recharger les tournées\r\n      await fetchTournees();\r\n      \r\n      if (rejected > 0) {\r\n        alert(`Modifications partiellement enregistrées. ${rejected} opérations ont échoué.`);\r\n      } else {\r\n        alert('Modifications enregistrées avec succès');\r\n      }\r\n      \r\n      // Désactiver le mode édition après sauvegarde réussie\r\n      setEditMode(false);\r\n      setSelectedTournees([]);\r\n      setSelectAll(false);\r\n      \r\n      console.log('Toutes les modifications ont été enregistrées avec succès');\r\n      return true;\r\n    } catch (error) {\r\n      console.error('Erreur lors de la sauvegarde des modifications:', error);\r\n      alert('Erreur lors de la sauvegarde des modifications. Veuillez réessayer.');\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const handleCellChange = (id: string, field: keyof Tournee, value: any) => {\r\n    console.log(`Mise à jour de la tournée ${id}, champ ${field} avec la valeur:`, value);\r\n    setEditingTournees({\r\n      ...editingTournees,\r\n      [id]: {\r\n        ...editingTournees[id],\r\n        [field]: value\r\n      }\r\n    });\r\n  };\r\n\r\n  const formatDateForInput = (date: Date | null): string => {\r\n    if (!date) return '';\r\n    const year = date.getFullYear();\r\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\r\n    const day = date.getDate().toString().padStart(2, '0');\r\n    return `${year}-${month}-${day}`;\r\n  };\r\n\r\n  const closeModal = () => {\r\n    setIsModalOpen(false);\r\n    setIsEditing(false);\r\n    setCurrentTournee({\r\n      nom: '',\r\n      heureDepart: '',\r\n      heureFinPrevue: '',\r\n      heureFinReelle: '',\r\n      coursier: '',\r\n      vehicules: [],\r\n      nombreColis: 0,\r\n      statut: 'en_attente',\r\n    });\r\n  };\r\n\r\n  // Fonction pour gérer le changement de pôle\r\n  const handlePoleChange = (pole: string) => {\r\n    setSelectedPole(pole);\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"loading-container\">\r\n        <div className=\"loading-spinner\"></div>\r\n        <p>Chargement des tournées...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"section-header\">\r\n        <h2 className=\"section-title\">Tournées</h2>\r\n      </div>\r\n      \r\n      <div className=\"sticky-header-container\">\r\n        <div className=\"header-actions\">\r\n          {editMode ? (\r\n            <>\r\n              <button \r\n                className=\"button\" \r\n                onClick={saveAllChanges}\r\n                disabled={loading || (selectedTournees.length === 0 && newTournees.length === 0)}\r\n                style={{ \r\n                  backgroundColor: '#4CAF50', // Vert\r\n                  color: 'white',\r\n                  fontWeight: 'bold'\r\n                }}\r\n                title=\"Enregistrer les modifications\"\r\n              >\r\n                <i className=\"fas fa-save\"></i> Enr. {selectedTournees.length > 0 || newTournees.length > 0 ? \r\n                  `(${selectedTournees.length}${newTournees.length > 0 ? `+${newTournees.length}` : ''})` : \r\n                  ''}\r\n              </button>\r\n              <button \r\n                className=\"button button-secondary\" \r\n                onClick={() => {\r\n                  if (window.confirm(\"Êtes-vous sûr de vouloir annuler toutes les modifications ?\")) {\r\n                    setEditingTournees({});\r\n                    setNewTournees([]);\r\n                    setSelectedTournees([]);\r\n                    setSelectAll(false);\r\n                    setEditMode(false);\r\n                  }\r\n                }}\r\n                style={{ marginLeft: '5px' }}\r\n                disabled={loading}\r\n                title=\"Annuler les modifications\"\r\n              >\r\n                <i className=\"fas fa-times\"></i> Annuler\r\n              </button>\r\n              <button \r\n                className=\"button\" \r\n                onClick={addNewTourneeRow}\r\n                style={{ \r\n                  marginLeft: '5px',\r\n                  backgroundColor: '#FF9800', // Orange\r\n                  color: 'white',\r\n                  fontWeight: 'bold'\r\n                }}\r\n                disabled={loading}\r\n                title=\"Ajouter une nouvelle tournée\"\r\n              >\r\n                <i className=\"fas fa-plus\"></i> Ajouter\r\n              </button>\r\n              <button \r\n                className=\"button button-danger\" \r\n                onClick={handleDeleteSelected}\r\n                disabled={selectedTournees.length === 0 || loading}\r\n                style={{ \r\n                  marginLeft: '5px',\r\n                  backgroundColor: '#f44336', \r\n                  color: 'white',\r\n                  fontWeight: 'bold'\r\n                }}\r\n                title=\"Supprimer les tournées sélectionnées\"\r\n              >\r\n                <i className=\"fas fa-trash-alt\"></i> Sup. ({selectedTournees.length})\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <button \r\n              className=\"button\" \r\n              onClick={toggleEditMode}\r\n            >\r\n              <i className=\"fas fa-edit\"></i> Modifier\r\n            </button>\r\n          )}\r\n        </div>\r\n        \r\n        <div className=\"quick-search-container\" style={{ marginTop: '10px' }}>\r\n          <input\r\n            type=\"text\"\r\n            className=\"quick-search-input\"\r\n            placeholder=\"Recherche rapide...\"\r\n            value={quickSearch}\r\n            onChange={(e) => setQuickSearch(e.target.value)}\r\n            disabled={loading}\r\n          />\r\n          <div className=\"pole-filter\">\r\n            <PoleFilter\r\n              onPoleChange={handlePoleChange}\r\n              selectedPole={selectedPole}\r\n              label=\"Filtrer par pôle\"\r\n              className=\"pole-filter-component\"\r\n            />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div className=\"tournees-table-container\" style={{ overflowX: 'auto' }}>\r\n        <div className=\"results-info\">\r\n          <p>{filteredTournees.length} résultat(s) trouvé(s){quickSearch ? ` pour la recherche \"${quickSearch}\"` : ''}</p>\r\n        </div>\r\n        <table className={`data-table ${editMode ? 'editing' : ''}`}>\r\n          <thead>\r\n            <tr>\r\n              {editMode && (\r\n                <th>\r\n                  <input \r\n                    type=\"checkbox\" \r\n                    checked={selectAll}\r\n                    onChange={handleSelectAllChange}\r\n                    title=\"Sélectionner/Désélectionner toutes les tournées\"\r\n                  />\r\n                </th>\r\n              )}\r\n              <th>PÔLE</th>\r\n              <th>Nom</th>\r\n              <th>Heure de Départ</th>\r\n              <th>Heure d'Arrivée</th>\r\n              <th>Véhicules</th>\r\n              <th>Statut</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {/* Nouvelles lignes temporaires */}\r\n            {editMode && newTournees.map((newTournee, index) => (\r\n              <tr key={newTournee.id} className=\"new-tournee-row\">\r\n                <td style={{display: 'none'}}>\r\n                  {/* Cellule masquée pour maintenir l'alignement */}\r\n                </td>\r\n                <td>\r\n                  <PoleSelector\r\n                    value={newTournee.pole || ''}\r\n                    onChange={(value) => handleNewTourneeChange(index, 'pole', value)}\r\n                    placeholder=\"Sélectionner un pôle\"\r\n                    style={{ width: '100%' }}\r\n                    showSearch\r\n                    allowClear\r\n                    title=\"Pôle de la tournée\"\r\n                  />\r\n                </td>\r\n                <td>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={newTournee.nom || ''}\r\n                    onChange={(e) => handleNewTourneeChange(index, 'nom', e.target.value)}\r\n                    className=\"inline-edit-input\"\r\n                    placeholder=\"Nom de la tournée\"\r\n                  />\r\n                </td>\r\n                <td style={{ position: 'relative' }}>\r\n                  <div className=\"custom-datepicker-wrapper\">\r\n                    <DatePicker\r\n                      selected={newTournee.heureDepart ? new Date(`2000-01-01T${newTournee.heureDepart}`) : null}\r\n                      onChange={(date: Date | null) => {\r\n                        if (date) {\r\n                          const hours = date.getHours().toString().padStart(2, '0');\r\n                          const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                          handleNewTourneeChange(index, 'heureDepart', `${hours}:${minutes}`);\r\n                        }\r\n                      }}\r\n                      locale=\"fr\"\r\n                      showTimeSelect\r\n                      showTimeSelectOnly\r\n                      timeIntervals={15}\r\n                      timeCaption=\"Heure\"\r\n                      dateFormat=\"HH:mm\"\r\n                      placeholderText=\"HH:MM\"\r\n                      className=\"custom-datepicker-input\"\r\n                      popperPlacement=\"bottom-start\"\r\n                      popperModifiers={[\r\n                        {\r\n                          name: 'offset',\r\n                          options: {\r\n                            offset: [0, 8],\r\n                          },\r\n                          fn: (state) => state\r\n                        },\r\n                      ]}\r\n                    />\r\n                    <span className=\"custom-datepicker-icon\">🕒</span>\r\n                  </div>\r\n                </td>\r\n                <td style={{ position: 'relative' }}>\r\n                  <div className=\"custom-datepicker-wrapper\">\r\n                    <DatePicker\r\n                      selected={newTournee.heureFinReelle ? new Date(`2000-01-01T${newTournee.heureFinReelle}`) : null}\r\n                      onChange={(date: Date | null) => {\r\n                        if (date) {\r\n                          const hours = date.getHours().toString().padStart(2, '0');\r\n                          const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                          handleNewTourneeChange(index, 'heureFinReelle', `${hours}:${minutes}`);\r\n                        }\r\n                      }}\r\n                      locale=\"fr\"\r\n                      showTimeSelect\r\n                      showTimeSelectOnly\r\n                      timeIntervals={15}\r\n                      timeCaption=\"Heure\"\r\n                      dateFormat=\"HH:mm\"\r\n                      placeholderText=\"HH:MM\"\r\n                      className=\"custom-datepicker-input\"\r\n                      popperPlacement=\"bottom-start\"\r\n                      popperModifiers={[\r\n                        {\r\n                          name: 'offset',\r\n                          options: {\r\n                            offset: [0, 8],\r\n                          },\r\n                          fn: (state) => state\r\n                        },\r\n                      ]}\r\n                    />\r\n                    <span className=\"custom-datepicker-icon\">🕒</span>\r\n                  </div>\r\n                </td>\r\n                <td>\r\n                  <div className=\"checkbox-list\" style={{ \r\n                    maxHeight: '150px', \r\n                    overflowY: 'auto',\r\n                    border: '1px solid #ddd',\r\n                    borderRadius: '4px',\r\n                    padding: '8px',\r\n                    backgroundColor: '#f9f9f9'\r\n                  }}>\r\n                    {vehicules.map(vehicule => (\r\n                      <div key={vehicule.id} style={{ marginBottom: '6px' }}>\r\n                        <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>\r\n                          <input \r\n                            type=\"checkbox\" \r\n                            checked={(newTournee.vehicules || []).includes(vehicule.id)}\r\n                            onChange={(e) => {\r\n                              const currentVehicules = [...(newTournee.vehicules || [])];\r\n                              if (e.target.checked) {\r\n                                // Ajouter le véhicule s'il n'est pas déjà présent\r\n                                if (!currentVehicules.includes(vehicule.id)) {\r\n                                  handleNewTourneeChange(index, 'vehicules', [...currentVehicules, vehicule.id]);\r\n                                }\r\n                              } else {\r\n                                // Retirer le véhicule\r\n                                handleNewTourneeChange(index, 'vehicules', currentVehicules.filter(id => id !== vehicule.id));\r\n                              }\r\n                            }}\r\n                            style={{ marginRight: '8px' }}\r\n                            title={`Sélectionner le véhicule ${vehicule.immatriculation}`}\r\n                          />\r\n                          {vehicule.immatriculation}\r\n                        </label>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </td>\r\n                <td>\r\n                  <select\r\n                    value={newTournee.statut || 'en_attente'}\r\n                    onChange={(e) => handleNewTourneeChange(index, 'statut', e.target.value)}\r\n                    className=\"inline-edit-select\"\r\n                    title=\"Statut de la tournée\"\r\n                  >\r\n                    <option value=\"en_attente\">En attente</option>\r\n                    <option value=\"en_cours\">En cours</option>\r\n                    <option value=\"terminee\">Terminée</option>\r\n                    <option value=\"annulee\">Annulée</option>\r\n                  </select>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n\r\n            {filteredTournees.map((tournee) => (\r\n              <tr key={tournee.id} className={selectedTournees.includes(tournee.id) ? 'selected-row' : ''}>\r\n                {editMode && (\r\n                  <td>\r\n                    <input \r\n                      type=\"checkbox\" \r\n                      checked={selectedTournees.includes(tournee.id)} \r\n                      onChange={() => toggleTourneeSelection(tournee.id)}\r\n                      title={`Sélectionner la tournée ${tournee.nom}`}\r\n                    />\r\n                  </td>\r\n                )}\r\n                <td>\r\n                  {editMode ? (\r\n                    <PoleSelector\r\n                      value={editingTournees[tournee.id]?.pole || tournee.pole || ''}\r\n                      onChange={(value) => handleCellChange(tournee.id, 'pole', value)}\r\n                      placeholder=\"Sélectionner un pôle\"\r\n                      style={{ width: '100%' }}\r\n                      showSearch\r\n                      allowClear\r\n                      title=\"Pôle de la tournée\"\r\n                    />\r\n                  ) : (\r\n                    getPoleNameById(tournee.pole)\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  {editMode ? (\r\n                    <input\r\n                      type=\"text\"\r\n                      value={editingTournees[tournee.id]?.nom || tournee.nom}\r\n                      onChange={(e) => handleCellChange(tournee.id, 'nom', e.target.value)}\r\n                      className=\"inline-edit-input\"\r\n                      placeholder=\"Nom de la tournée\"\r\n                    />\r\n                  ) : (\r\n                    tournee.nom\r\n                  )}\r\n                </td>\r\n                <td style={{ position: 'relative' }}>\r\n                  {editMode ? (\r\n                    <div className=\"custom-datepicker-wrapper\">\r\n                      <DatePicker\r\n                        selected={editingTournees[tournee.id]?.heureDepart ? new Date(`2000-01-01T${editingTournees[tournee.id].heureDepart}`) : tournee.heureDepart ? new Date(`2000-01-01T${tournee.heureDepart}`) : null}\r\n                        onChange={(date: Date | null) => {\r\n                          if (date) {\r\n                            const hours = date.getHours().toString().padStart(2, '0');\r\n                            const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                            handleCellChange(tournee.id, 'heureDepart', `${hours}:${minutes}`);\r\n                          }\r\n                        }}\r\n                        locale=\"fr\"\r\n                        showTimeSelect\r\n                        showTimeSelectOnly\r\n                        timeIntervals={15}\r\n                        timeCaption=\"Heure\"\r\n                        dateFormat=\"HH:mm\"\r\n                        placeholderText=\"HH:MM\"\r\n                        className=\"custom-datepicker-input\"\r\n                        popperPlacement=\"bottom-start\"\r\n                        popperModifiers={[\r\n                          {\r\n                            name: 'offset',\r\n                            options: {\r\n                              offset: [0, 8],\r\n                            },\r\n                            fn: (state) => state\r\n                          },\r\n                        ]}\r\n                      />\r\n                      <span className=\"custom-datepicker-icon\">🕒</span>\r\n                    </div>\r\n                  ) : (\r\n                    tournee.heureDepart || '-'\r\n                  )}\r\n                </td>\r\n                <td style={{ position: 'relative' }}>\r\n                  {editMode ? (\r\n                    <div className=\"custom-datepicker-wrapper\">\r\n                      <DatePicker\r\n                        selected={editingTournees[tournee.id]?.heureFinReelle ? new Date(`2000-01-01T${editingTournees[tournee.id].heureFinReelle}`) : tournee.heureFinReelle ? new Date(`2000-01-01T${tournee.heureFinReelle}`) : null}\r\n                        onChange={(date: Date | null) => {\r\n                          if (date) {\r\n                            const hours = date.getHours().toString().padStart(2, '0');\r\n                            const minutes = date.getMinutes().toString().padStart(2, '0');\r\n                            handleCellChange(tournee.id, 'heureFinReelle', `${hours}:${minutes}`);\r\n                          }\r\n                        }}\r\n                        locale=\"fr\"\r\n                        showTimeSelect\r\n                        showTimeSelectOnly\r\n                        timeIntervals={15}\r\n                        timeCaption=\"Heure\"\r\n                        dateFormat=\"HH:mm\"\r\n                        placeholderText=\"HH:MM\"\r\n                        className=\"custom-datepicker-input\"\r\n                        popperPlacement=\"bottom-start\"\r\n                        popperModifiers={[\r\n                          {\r\n                            name: 'offset',\r\n                            options: {\r\n                              offset: [0, 8],\r\n                            },\r\n                            fn: (state) => state\r\n                          },\r\n                        ]}\r\n                      />\r\n                      <span className=\"custom-datepicker-icon\">🕒</span>\r\n                    </div>\r\n                  ) : (\r\n                    tournee.heureFinReelle || '-'\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  {editMode ? (\r\n                    <div className=\"checkbox-list\" style={{ \r\n                      maxHeight: '150px', \r\n                      overflowY: 'auto',\r\n                      border: '1px solid #ddd',\r\n                      borderRadius: '4px',\r\n                      padding: '8px',\r\n                      backgroundColor: '#f9f9f9'\r\n                    }}>\r\n                      {vehicules.map(vehicule => (\r\n                        <div key={vehicule.id} style={{ marginBottom: '6px' }}>\r\n                          <label style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>\r\n                            <input \r\n                              type=\"checkbox\" \r\n                              checked={(editingTournees[tournee.id]?.vehicules || tournee.vehicules).includes(vehicule.id)}\r\n                              onChange={(e) => {\r\n                                const currentVehicules = [...(editingTournees[tournee.id]?.vehicules || tournee.vehicules)];\r\n                                if (e.target.checked) {\r\n                                  // Ajouter le véhicule s'il n'est pas déjà présent\r\n                                  if (!currentVehicules.includes(vehicule.id)) {\r\n                                    handleCellChange(tournee.id, 'vehicules', [...currentVehicules, vehicule.id]);\r\n                                  }\r\n                                } else {\r\n                                  // Retirer le véhicule\r\n                                  handleCellChange(tournee.id, 'vehicules', currentVehicules.filter(id => id !== vehicule.id));\r\n                                }\r\n                              }}\r\n                              style={{ marginRight: '8px' }}\r\n                            />\r\n                            {vehicule.immatriculation}\r\n                          </label>\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  ) : (\r\n                    tournee.vehicules.map(vehiculeId => {\r\n                      const vehicule = vehicules.find(v => v.id === vehiculeId);\r\n                      return vehicule ? vehicule.immatriculation : vehiculeId;\r\n                    }).join(', ')\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  {editMode ? (\r\n                    <select\r\n                      value={editingTournees[tournee.id]?.statut || tournee.statut}\r\n                      onChange={(e) => handleCellChange(tournee.id, 'statut', e.target.value as 'en_attente' | 'en_cours' | 'terminee' | 'annulee')}\r\n                      className=\"inline-edit-select\"\r\n                      title=\"Statut de la tournée\"\r\n                    >\r\n                      <option value=\"en_attente\">En attente</option>\r\n                      <option value=\"en_cours\">En cours</option>\r\n                      <option value=\"terminee\">Terminée</option>\r\n                      <option value=\"annulee\">Annulée</option>\r\n                    </select>\r\n                  ) : (\r\n                    <span className={getStatusClass(tournee.statut)}>\r\n                      {getStatusText(tournee.statut)}\r\n                    </span>\r\n                  )}\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Tournees;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}